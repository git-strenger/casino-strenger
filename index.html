<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Strenger Casino Roulette - Premium Edition</title>
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

    <style>
      :root{
        --bg-body: #0b0d10;       
        --bg-panel: #131519;      
        --bg-element: #1c1f24;    
        --accent: #f59e0b;        
        --accent-hover: #d97706;
        --text-main: #ffffff;
        --text-muted: #9ca3af;
        
        --gold-1: #bf953f;
        --gold-2: #fcf6ba;
        --gold-3: #b38728;
        
        --gap: 6px;
        --radius: 12px;
      }

      *{box-sizing:border-box}
      body {
        margin: 0; padding: 0;
        font-family: 'Inter', sans-serif;
        background-color: var(--bg-body);
        color: var(--text-main);
        min-height: 100vh;
        display: flex; flex-direction: column; overflow-y: auto;
        overflow-x: hidden;
      }
      
      /* Custom Scrollbar */
      ::-webkit-scrollbar { width: 8px; height: 8px; }
      ::-webkit-scrollbar-track { background: #0b0d10; }
      ::-webkit-scrollbar-thumb { background: #333; border-radius: 4px; }
      ::-webkit-scrollbar-thumb:hover { background: #444; }

      /* HEADER */
      header {
        height: 70px;
        border-bottom: 1px solid rgba(255,255,255,0.05);
        display: grid; 
        grid-template-columns: 320px 1fr 320px;
        gap: 20px;
        align-items: center;
        padding: 0 20px; background: var(--bg-panel); flex: 0 0 auto; z-index: 500;
        position: relative;
      }
      .brand { display: flex; align-items: center; gap: 12px; justify-self: start; }
      .brand svg { width: 42px; height: 42px; filter: drop-shadow(0 2px 3px rgba(0,0,0,0.5)); }
      .brand-text { display: flex; flex-direction: column; line-height: 1; justify-content: center; }
      .brand-title {
        font-family: 'Cinzel', serif; font-weight: 700; font-size: 18px; letter-spacing: 1px;
        background: linear-gradient(to right, var(--gold-1), var(--gold-2), var(--gold-3));
        -webkit-background-clip: text; background-clip: text; color: transparent; text-transform: uppercase;
      }
      .brand-subtitle {
        font-family: 'Cinzel', serif; font-weight: 400; font-size: 10px; letter-spacing: 3px;
        color: #cfb53b; text-transform: uppercase; margin-top: 3px;
      }
      .user-stats { display: flex; gap: 15px; font-size: 12px; font-weight: 600; align-items: center; justify-self: end; }
      .balance-main {
        display: flex; gap: 12px; align-items: center; 
        justify-self: center;
      }
      .balance-icon { 
        width: 32px; height: 32px; 
        background: linear-gradient(135deg, var(--accent), #ea580c); 
        border-radius: 50%; display: grid; place-items: center; 
        font-size: 16px; box-shadow: 0 2px 8px rgba(245,158,11,0.4);
      }
      .balance-icon:hover {
        transform: scale(1.1);
        box-shadow: 0 4px 16px rgba(245,158,11,0.6);
      }
      .balance-amount { color: var(--gold-2); font-family: monospace; font-size: 20px; font-weight: 700; letter-spacing: 0.5px; }
      .stat-box { 
        background: var(--bg-element); padding: 8px 14px; border-radius: 12px; 
        display: flex; gap: 8px; align-items: center; border: 1px solid rgba(255,255,255,0.05); cursor: pointer;
      }
      .stat-box:hover { background: rgba(255,255,255,0.08); }
      #settingsBtn:hover {
        background: rgba(255,255,255,0.1);
      }
      .stat-box:has(#userAvatar):hover {
        background: rgba(245,158,11,0.1);
        border-color: rgba(245,158,11,0.2);
      }
      #btnConnect:hover {
        background: rgba(34,197,94,0.1);
        border-color: rgba(34,197,94,0.2);
      }
      .money { color: var(--gold-2); font-family: monospace; font-size: 13px;}

      /* LAYOUT */
      .dashboard {
        flex: 1; 
        display: grid; 
        grid-template-columns: 320px 1fr 320px;
        grid-template-rows: 1fr auto;
        gap: 20px; 
        padding: 20px; 
        overflow: visible;
        position: relative;
        z-index: 1;
      }
      .left-column {
        grid-column: 1;
        grid-row: 1;
        overflow: hidden;
      }
      .left-column .panel {
        height: 100%;
      }
      .game-area {
        grid-column: 2;
        grid-row: 1;
        display: flex; 
        flex-direction: column; 
        gap: 20px;
        overflow: visible;
      }
      .right-column {
        grid-column: 3;
        grid-row: 1;
        display: flex;
        flex-direction: column;
        gap: 20px;
        overflow: hidden;
      }
      .right-column .panel {
        flex: 0 0 auto;
      }
      .top-players-full {
        grid-column: 1 / 3;
        grid-row: 2;
        height: 500px;
      }
      .top-players-full .panel-body {
        overflow-y: auto;
      }
      .chat-extended {
        grid-column: 3;
        grid-row: 2;
        height: 500px;
        display: flex;
        flex-direction: column;
      }
      .chat-extended .panel-body {
        flex: 1;
        min-height: 0;
      }
      .panel {
        background: var(--bg-panel); border-radius: 16px; border: 1px solid rgba(255,255,255,0.03);
        display: flex; flex-direction: column; overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.3);
      }
      .panel-head {
        padding: 14px 16px; font-size: 11px; font-weight: 700; text-transform: uppercase; color: var(--text-muted);
        border-bottom: 1px solid rgba(255,255,255,0.03); display: flex; justify-content: space-between;
      }
      .live-indicator {
        color: #ef4444;
        font-size: 8px;
        vertical-align: middle;
        margin-left: 6px;
        animation: livePulse 2s ease-in-out infinite;
        text-shadow: 0 0 10px rgba(239, 68, 68, 0.6);
      }
      .panel-body { flex: 1; overflow-y: auto; padding: 0; }

      /* LEFT: PLAYERS */
      .player-item {
        display: flex; align-items: center; padding: 12px 16px; border-bottom: 1px solid rgba(255,255,255,0.02); font-size: 13px;
        transition: background 0.2s;
      }
      .player-item:hover { background: rgba(255,255,255,0.02); }
      .avatar { 
        width: 36px; height: 36px; border-radius: 12px; 
        margin-right: 12px; display: grid; place-items: center; 
        font-weight: bold; font-size: 14px; 
        box-shadow: 0 2px 8px rgba(0,0,0,0.3);
      }
      .p-name { color: #e5e7eb; font-weight: 600; font-size: 13px; } 
      .p-win { color: #cfb53b; font-size: 12px; font-weight: 700; font-family: monospace; text-align: right;}
      
      /* Top Players Section */
      .tabs { display: flex; border-bottom: 1px solid rgba(255,255,255,0.03); border-top: 1px solid rgba(255,255,255,0.03); background: #0f1113; }
      .tab { 
        flex: 1; padding: 12px 8px; text-align: center; font-size: 10px; 
        font-weight: 700; text-transform: uppercase; cursor: pointer; 
        color: var(--text-muted); border-bottom: 2px solid transparent; transition: all 0.2s;
      }
      .tab.active { color: var(--accent); border-bottom-color: var(--accent); }
      .tab:hover { color: #e5e7eb; }
      .leaderboard { padding: 10px; font-size: 11px; }
      .leaderboard-header { display: grid; grid-template-columns: 3fr 2fr 1fr 2fr 2fr 2fr; padding: 8px 10px; font-size: 9px; color: var(--text-muted); font-weight: 700; text-transform: uppercase; border-bottom: 1px solid rgba(255,255,255,0.03); }
      .leaderboard-row { display: grid; grid-template-columns: 3fr 2fr 1fr 2fr 2fr 2fr; padding: 10px; border-bottom: 1px solid rgba(255,255,255,0.02); transition: all 0.3s; align-items: center; border-radius: 8px; animation: rowFadeIn 0.4s ease-out; }
      .leaderboard-row:hover { background: rgba(255,255,255,0.02); transform: translateX(2px); }
      @keyframes rowFadeIn {
        0% { opacity: 0; transform: translateY(-10px); }
        100% { opacity: 1; transform: translateY(0); }
      }
      @keyframes livePulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.3; }
      }
      #liveDot {
        animation: livePulse 1.5s ease-in-out infinite;
      }
      .lb-user { color: #e5e7eb; }
      .lb-profit { color: #22c55e; font-weight: 700; font-family: monospace; }
      .big-win-row {
        background: linear-gradient(90deg, rgba(34,197,94,0.1) 0%, transparent 100%) !important;
        border-left: 3px solid #22c55e !important;
      }

      /* CENTER: GAME AREA (Compactado) */

      /* WHEEL - Modern Arc Style */
      .wheel-stage {
        flex: 0 0 auto;
        background: radial-gradient(ellipse at center top, rgba(255,255,255,0.02), transparent 70%);
        border: none;
        position: relative; 
        display: flex; justify-content: center; align-items: center;
        padding: 40px 20px 30px 20px;
        z-index: 1;
        margin-top: -380px;
        overflow: visible;
      }
      /* Indicador fixo em 6 horas (bottom) */
      .wheel-mask { 
        width: 700px; 
        height: 700px; 
        position: relative; 
        display: flex;
        justify-content: center;
        align-items: center;
      }
      
      /* Indicador - base dourada no bottom (6 horas) */
      .wheel-indicator {
        position: absolute;
        bottom: -8px;
        left: 50%;
        transform: translateX(-50%);
        z-index: 100;
      }
      .wheel-indicator-base {
        width: 6.8%;
        min-width: 26px;
        max-width: 48px;
        height: 14px;
        background: linear-gradient(to top, var(--gold-2), var(--gold-1), var(--gold-3));
        border-radius: 0 0 8px 8px;
        box-shadow: 
          0 4px 15px rgba(245,196,81,0.4),
          0 -4px 12px rgba(0,0,0,0.5),
          inset 0 -2px 4px rgba(255,255,255,0.3);
        animation: baseGlow 2s ease-in-out infinite;
      }
      @keyframes baseGlow {
        0%, 100% { box-shadow: 0 4px 10px rgba(245,196,81,0.4), 0 -4px 8px rgba(0,0,0,0.5), inset 0 -2px 4px rgba(255,255,255,0.3); }
        50% { box-shadow: 0 4px 18px rgba(245,196,81,0.6), 0 -4px 8px rgba(0,0,0,0.5), inset 0 -2px 4px rgba(255,255,255,0.3); }
      }
      
      /* Efeito quando n√∫mero passa pelo indicador */
      .wheel-indicator.active .wheel-indicator-base {
        box-shadow: 0 0 30px var(--gold-2), 0 4px 12px rgba(0,0,0,0.5);
        transform: scaleX(1.1);
      }
      .wheel {
        width: 100%;
        height: 100%;
        position: relative;
        display: flex;
        justify-content: center;
        align-items: center;
        transition: transform 0.05s linear;
      }
      /* Outer rim */
      .wheel::before {
        content: '';
        position: absolute;
        width: 100%;
        height: 100%;
        border-radius: 50%;
        background: 
          radial-gradient(circle at 35% 35%, #1a1206, #0f0a04 60%, #000000);
        box-shadow: 
          inset 0 0 50px rgba(0,0,0,0.95),
          0 15px 50px rgba(0,0,0,0.8);
        z-index: 0;
      }
      /* Center hub - removed */
      .pointer {
        display: none;
      }
      /* Bolinha dourada acima da seta removida */
      .numbers { 
        position: absolute;
        width: 100%;
        height: 100%;
        border-radius: 50%;
        transform-style: preserve-3d;
      }
      .num { 
        width: 6.8%;
        height: 13.5%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: clamp(10px, 3vw, 22px);
        font-weight: 900;
        color: #fff;
        position: absolute;
        left: 50%;
        top: 50%;
        clip-path: polygon(0% 0%, 100% 0%, 75% 100%, 25% 100%);
        border: 2px solid rgba(0,0,0,0.9);
        box-shadow: 
          0 5px 15px rgba(0,0,0,0.9), 
          inset 0 3px 6px rgba(255,255,255,0.2),
          inset 0 -3px 6px rgba(0,0,0,0.5);
        text-shadow: 0 3px 8px rgba(0,0,0,1);
        letter-spacing: 0.5px;
        transform-origin: 50% 50%;
        z-index: 10;
      }
      .num.red {
        background: linear-gradient(160deg, #e63946 0%, #d62828 50%, #9d0208 100%);
        border-color: rgba(100,0,0,0.9);
      }
      .num.black {
        background: linear-gradient(160deg, #2b2b2b 0%, #1a1a1a 50%, #000000 100%);
        border-color: rgba(0,0,0,1);
      }
      .num.green {
        background: linear-gradient(160deg, #2d6a4f 0%, #1b4332 50%, #0a1f15 100%);
        border-color: rgba(0,40,0,0.9);
      }
      .num.active {
        box-shadow: 
          0 0 15px rgba(255,215,0,0.9),
          0 0 25px rgba(255,215,0,0.5),
          inset 0 3px 6px rgba(255,255,255,0.5);
        z-index: 20;
        border-color: var(--gold-1);
        filter: brightness(1.7);
      }
      .pockets { 
        position: absolute;
        width: 100%;
        height: 100%;
        border-radius: 50%;
        pointer-events: none;
      }
      .pocket { 
        display: none;
      }
      /* Bolinha removida - usando indicador fixo */
      .ball { 
        display: none;
      }
      
      /* WIN/LOSE Indicator in center of wheel */
      .result-overlay {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%) scale(0);
        z-index: 600;
        pointer-events: none;
        opacity: 0;
        transition: all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      }
      .result-overlay.show {
        transform: translate(-50%, -50%) scale(1);
        opacity: 1;
      }
      .result-text {
        font-family: 'Cinzel', serif;
        font-size: 48px;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 4px;
        text-shadow: 
          0 0 20px currentColor,
          0 0 40px currentColor,
          0 4px 8px rgba(0,0,0,0.8);
        padding: 20px 40px;
        border-radius: 20px;
        border: 4px solid currentColor;
        background: rgba(0,0,0,0.8);
        backdrop-filter: blur(10px);
        animation: resultPulse 1s ease-in-out infinite;
      }
      .result-text.win {
        color: #22c55e;
        box-shadow: 
          0 0 40px rgba(34,197,94,0.6),
          0 0 80px rgba(34,197,94,0.3),
          inset 0 0 40px rgba(34,197,94,0.1);
      }
      .result-text.lose {
        color: #ef4444;
        box-shadow: 
          0 0 40px rgba(239,68,68,0.6),
          0 0 80px rgba(239,68,68,0.3),
          inset 0 0 40px rgba(239,68,68,0.1);
      }
      @keyframes resultPulse {
        0%, 100% { transform: scale(1); }
        50% { transform: scale(1.05); }
      }
      
      /* Confetti */
      .confetti {
        position: fixed;
        width: 10px;
        height: 10px;
        z-index: 9998;
        pointer-events: none;
        animation: confettiFall var(--duration, 3s) linear forwards;
      }
      .confetti.square {
        border-radius: 2px;
      }
      .confetti.circle {
        border-radius: 50%;
      }
      .confetti.ribbon {
        width: 8px;
        height: 20px;
        border-radius: 2px;
      }
      
      @keyframes confettiFall {
        0% {
          opacity: 1;
          transform: translateY(0) translateX(0) rotate(0deg) scale(1);
        }
        25% {
          opacity: 1;
          transform: translateY(calc(var(--fall-distance, 800px) * 0.25)) translateX(var(--sway, 50px)) rotate(calc(var(--rotation, 720deg) * 0.25)) scale(0.9);
        }
        50% {
          opacity: 1;
          transform: translateY(calc(var(--fall-distance, 800px) * 0.5)) translateX(calc(var(--sway, 50px) * -0.5)) rotate(calc(var(--rotation, 720deg) * 0.5)) scale(0.8);
        }
        75% {
          opacity: 0.7;
          transform: translateY(calc(var(--fall-distance, 800px) * 0.75)) translateX(var(--sway, 50px)) rotate(calc(var(--rotation, 720deg) * 0.75)) scale(0.6);
        }
        100% {
          opacity: 0;
          transform: translateY(var(--fall-distance, 800px)) translateX(0) rotate(var(--rotation, 720deg)) scale(0.3);
        }
      }

      /* TABLE - Sobre o fundo */
      .table-container {
        flex: 1;
        background: transparent; 
        border: none;
        padding: 10px 20px 20px 20px;
        display: flex; flex-direction: column; align-items: center; 
        overflow-x: auto;
      }

      .table-layout {
        display: grid;
        grid-template-columns: 50px repeat(12, 42px) 50px; 
        gap: var(--gap);
      }

      .cell {
        height: 42px;
        background: var(--bg-element);
        border-radius: var(--radius);
        display: grid; place-items: center;
        font-weight: 700; font-size: 14px;
        color: #e5e7eb; cursor: pointer;
        position: relative; transition: all 0.1s; user-select: none;
      }
      .cell:hover { filter: brightness(1.2); transform: translateY(-1px); }
      .cell:active { transform: translateY(1px); }

      /* CORES ESCURAS */
      .c-red { background: linear-gradient(145deg, #b91c1c, #7f1d1d); box-shadow: inset 0 1px 0 rgba(255,255,255,0.05); border: 1px solid rgba(0,0,0,0.2); }
      .c-black { background: linear-gradient(145deg, #27272a, #09090b); box-shadow: inset 0 1px 0 rgba(255,255,255,0.05); border: 1px solid rgba(0,0,0,0.3); }
      .c-green { background: linear-gradient(145deg, #15803d, #14532d); box-shadow: inset 0 1px 0 rgba(255,255,255,0.05); border: 1px solid rgba(0,0,0,0.2); }
      
      .c-zero { grid-row: 1 / span 3; height: 100%; font-size: 16px; } 
      .c-2to1 { background: transparent; border: 1px solid rgba(255,255,255,0.1); color: var(--text-muted); font-size: 11px; }

      .cell.c-dozen {
        background: var(--bg-element); border: 1px solid rgba(255,255,255,0.05);
        font-size: 11px; text-transform: uppercase; color: #fff; grid-column: span 4;
      }

      .cell.c-simple {
        background: var(--bg-element); border: 1px solid rgba(255,255,255,0.05);
        font-size: 11px; text-transform: uppercase; color: #fff; grid-column: span 2;
      }
      
      .c-simple.red-btn { background: linear-gradient(145deg, #b91c1c, #7f1d1d); border-color: #7f1d1d; }
      .c-simple.black-btn { background: linear-gradient(145deg, #27272a, #09090b); border-color: #000; }

      .spacer-zero { grid-column: 1; visibility: hidden; }

      .chip-render {
        position: absolute; width: 20px; height: 20px;
        border: 1px solid #fff; border-radius: 50%;
        box-shadow: 0 3px 6px rgba(0,0,0,0.6);
        font-size: 8px; color: #fff; font-weight: 900;
        display: grid; place-items: center; pointer-events: none; z-index: 5;
      }
      
      /* Chip render colors - match the chip selector colors */
      .chip-render-purple { background: radial-gradient(circle at 30% 30%, #c084fc, #7c3aed); }
      .chip-render-blue { background: radial-gradient(circle at 30% 30%, #60a5fa, #2563eb); }
      .chip-render-green { background: radial-gradient(circle at 30% 30%, #4ade80, #16a34a); }
      .chip-render-red { background: radial-gradient(circle at 30% 30%, #f87171, #dc2626); }
      .chip-render-gold { background: radial-gradient(circle at 30% 30%, #fbbf24, #d97706); }
      .chip-render-default { background: radial-gradient(circle at 30% 30%, var(--accent), #b45309); }
      .cell.win-anim { 
        box-shadow: 
          0 0 0 3px var(--gold-1), 
          0 0 20px var(--gold-2), 
          0 0 40px var(--accent),
          inset 0 0 20px rgba(255,215,0,0.3); 
        z-index: 10; 
        border-color: var(--gold-1);
        animation: winPulse 1.5s ease-in-out infinite;
        transform: scale(1.1);
      }
      
      @keyframes winPulse {
        0%, 100% { 
          box-shadow: 
            0 0 0 3px var(--gold-1), 
            0 0 20px var(--gold-2), 
            0 0 40px var(--accent),
            inset 0 0 20px rgba(255,215,0,0.3);
        }
        50% { 
          box-shadow: 
            0 0 0 4px var(--gold-2), 
            0 0 30px var(--gold-1), 
            0 0 60px var(--accent),
            inset 0 0 30px rgba(255,215,0,0.5);
        }
      }

      /* RIGHT CONTROLS */
      .controls-body { padding: 12px; display: flex; flex-direction: column; gap: 12px; overflow-y: auto; }
      .label { font-size: 10px; color: var(--text-muted); font-weight: 700; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px; display:block;}
      
      /* Toggle Manual/Auto */
      .mode-toggle { display: flex; background: var(--bg-element); border-radius: 10px; padding: 3px; margin-bottom: 8px; }
      .mode-btn { flex: 1; padding: 6px; text-align: center; font-size: 10px; font-weight: 700; text-transform: uppercase; cursor: pointer; border-radius: 8px; transition: all 0.2s; color: var(--text-muted); }
      .mode-btn.active { background: var(--accent); color: #fff; }
      
      .bet-input { background: #000; border: 1px solid #222; color: #fff; padding: 12px; border-radius: 10px; font-size: 16px; font-weight: bold; width: 100%; outline:none; }
      .bet-input:focus { border-color: var(--accent); }
      .bet-limits { font-size: 9px; color: #555; margin-top: 4px; margin-bottom: 8px; display: flex; justify-content: space-between; }
      
      .chips-area { display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px 10px; row-gap: 14px; margin-top: 10px; margin-bottom: 10px; }
      .chip-select {
        aspect-ratio: 1; border-radius: 50%; border: 3px solid transparent;
        display: grid; place-items: center; font-size: 11px; font-weight: 900; cursor: pointer;
        box-shadow: 0 4px 8px rgba(0,0,0,0.4), inset 0 2px 4px rgba(255,255,255,0.1); position: relative;
        transition: all 0.15s;
      }
      .chip-select::before { 
        content:''; position: absolute; inset: 6px; 
        border: 2px dashed rgba(255,255,255,0.3); border-radius: 50%; 
      }
      .chip-select:hover { transform: translateY(-2px); }
      .chip-select.active { border-color: #fff; transform: scale(1.15); box-shadow: 0 6px 16px rgba(255,255,255,0.3); }
      
      /* Chip Colors */
      .chip-purple { background: radial-gradient(circle at 30% 30%, #c084fc, #7c3aed); color: #fff; }
      .chip-blue { background: radial-gradient(circle at 30% 30%, #60a5fa, #2563eb); color: #fff; }
      .chip-green { background: radial-gradient(circle at 30% 30%, #4ade80, #16a34a); color: #fff; }
      .chip-red { background: radial-gradient(circle at 30% 30%, #f87171, #dc2626); color: #fff; }
      .chip-gold { background: radial-gradient(circle at 30% 30%, #fbbf24, #d97706); color: #fff; }
      .chip-clear { background: #1c1f24; border: 2px dashed #444; color: #888; font-size: 18px; }
      .chip-clear::before { display: none; }
      
      /* Total Bet Display */
      .total-bet-display {
        background: linear-gradient(145deg, rgba(234, 88, 12, 0.08), rgba(249, 115, 22, 0.05));
        border: 1px solid rgba(234, 88, 12, 0.2);
        border-radius: 10px;
        padding: 10px 14px;
        text-align: center;
        margin: 8px 0;
      }
      .total-bet-label {
        font-size: 9px;
        color: var(--text-muted);
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 1px;
        margin-bottom: 4px;
      }
      .total-bet-value {
        font-size: 18px;
        font-weight: 800;
        color: var(--accent);
        text-shadow: 0 0 10px rgba(234, 88, 12, 0.4);
      }
      .total-bet-display.has-bets {
        background: linear-gradient(145deg, rgba(234, 88, 12, 0.15), rgba(249, 115, 22, 0.08));
        border-color: rgba(234, 88, 12, 0.4);
        box-shadow: 0 0 15px rgba(234, 88, 12, 0.2);
      }
      
      .btn-big {
        width: 100%; padding: 12px; background: linear-gradient(to bottom, var(--accent), #ea580c);
        color: #fff; border: none; border-radius: 12px; font-weight: 800; font-size: 13px; text-transform: uppercase;
        cursor: pointer; box-shadow: 0 4px 12px rgba(234, 88, 12, 0.4); transition: 0.1s; letter-spacing: 0.5px;
      }
      .btn-big:hover { filter: brightness(1.1); transform: translateY(-1px); }
      .btn-big:disabled { background: #333; color: #555; box-shadow: none; cursor: not-allowed; }
      
      /* History Numbers - Square format like table cells */
      .history-coins { 
        display: grid; 
        grid-template-columns: repeat(5, 1fr); 
        gap: 8px; 
      }
      .coin-slot {
        aspect-ratio: 1;
        border-radius: var(--radius);
        border: 1px solid rgba(255,255,255,0.1);
        background: rgba(255,255,255,0.02);
        display: grid; place-items: center;
        font-weight: 700; font-size: 11px;
        color: #e5e7eb;
        transition: all 0.3s ease;
        position: relative;
        box-shadow: inset 0 1px 0 rgba(255,255,255,0.05);
      }
      .coin-slot.latest {
        transform: scale(1.1);
        border-width: 2px;
        border-color: var(--gold-1);
        box-shadow: 
          0 0 12px rgba(245,196,81,0.5),
          inset 0 1px 0 rgba(255,255,255,0.1);
        z-index: 5;
        animation: latestPulse 0.5s ease-out;
      }
      @keyframes latestPulse {
        0% { transform: scale(0.7); opacity: 0; }
        50% { transform: scale(1.2); }
        100% { transform: scale(1.1); opacity: 1; }
      }
      .coin-red { 
        background: linear-gradient(145deg, #b91c1c, #7f1d1d); 
        border-color: rgba(0,0,0,0.2);
      }
      .coin-black { 
        background: linear-gradient(145deg, #27272a, #09090b); 
        border-color: rgba(0,0,0,0.3);
      }
      .coin-green { 
        background: linear-gradient(145deg, #15803d, #14532d); 
        border-color: rgba(0,0,0,0.2);
      }
      .chat-msgs { flex: 1; overflow-y: auto; padding: 15px; font-size: 11px; color: #9ca3af; min-height: 0; }
      .chat-row { 
        margin-bottom: 12px; line-height: 1.5; 
        padding: 8px; border-radius: 10px;
        background: rgba(255,255,255,0.02);
      }
      .chat-row:hover { background: rgba(255,255,255,0.04); }
      .chat-input { 
        padding: 12px; background: #0b0d10; border: none; 
        border-top: 1px solid #222; color: #fff; width: 100%; 
        outline: none; font-size: 11px; 
      }
      .chat-input:focus { background: #131519; }

      /* TABLET */
      @media (max-width: 1100px) {
        .dashboard { 
          grid-template-columns: 1fr 1fr; 
          overflow-y: auto; 
        }
        .left-column { display: none; }
        .game-area { grid-column: 1 / -1; }
        .right-column { grid-column: 1 / -1; flex-direction: row; flex-wrap: wrap; }
        .right-column .panel { flex: 1 1 300px; }
        .top-players-full { grid-column: 1 / -1; height: 350px; }
        .chat-extended { grid-column: 1 / -1; height: 300px; }
        .wheel-stage { margin-top: -250px; }
        .wheel-mask { 
          width: 60vw; 
          height: 60vw;
          max-width: 500px;
          max-height: 500px;
        }
      }
      
      /* MOBILE */
      @media (max-width: 768px) {
        /* Header mobile */
        header {
          height: auto;
          min-height: 60px;
          grid-template-columns: 1fr;
          gap: 10px;
          padding: 10px 12px;
        }
        .brand { justify-self: center; }
        .brand svg { width: 32px; height: 32px; }
        .brand-title { font-size: 14px; }
        .brand-subtitle { font-size: 8px; }
        .brand-text { display: none; }
        .balance-main { 
          justify-self: center; 
          order: -1;
          background: var(--bg-element);
          padding: 8px 16px;
          border-radius: 20px;
          border: 1px solid rgba(255,255,255,0.1);
        }
        .balance-amount { font-size: 16px; }
        .user-stats { 
          justify-self: center; 
          gap: 8px;
          flex-wrap: wrap;
          justify-content: center;
        }
        .stat-box { 
          padding: 6px 10px; 
          height: auto !important;
        }
        .stat-box:has(#userAvatar) > div:last-child { display: none; }
        #settingsBtn { font-size: 16px !important; }
        
        /* Dashboard mobile */
        .dashboard {
          grid-template-columns: 1fr;
          gap: 12px;
          padding: 12px;
          overflow-y: auto;
        }
        .left-column { display: none; }
        .game-area { grid-column: 1; }
        .right-column { 
          grid-column: 1; 
          flex-direction: column;
        }
        .right-column .panel { flex: 0 0 auto; }
        .top-players-full { 
          grid-column: 1; 
          height: 280px;
        }
        .chat-extended { 
          grid-column: 1; 
          height: 250px;
        }
        
        /* Wheel mobile */
        .wheel-stage { 
          margin-top: -150px;
          padding: 20px 10px;
        }
        .wheel-mask { 
          width: 90vw; 
          height: 90vw;
          max-width: 350px;
          max-height: 350px;
        }
        .wheel-indicator { bottom: -5px; }
        .wheel-indicator-base { height: 10px; }
        
        /* Result overlay */
        .result-text {
          font-size: 28px;
          padding: 12px 24px;
        }
        
        /* Table mobile */
        .table-container {
          padding: 8px;
          overflow-x: auto;
          -webkit-overflow-scrolling: touch;
        }
        .table-layout {
          grid-template-columns: 36px repeat(12, 32px) 36px;
          gap: 3px;
          min-width: max-content;
        }
        .cell {
          height: 36px;
          font-size: 11px;
          border-radius: 8px;
        }
        .cell.c-dozen, .cell.c-simple { font-size: 9px; }
        
        /* Controls mobile */
        .controls-body { padding: 10px; gap: 10px; }
        .mode-toggle { margin-bottom: 4px; }
        .mode-btn { padding: 8px; font-size: 11px; }
        .bet-input { 
          padding: 10px; 
          font-size: 14px; 
        }
        .chips-area { 
          grid-template-columns: repeat(5, 1fr); 
          gap: 6px;
        }
        .chip-select { 
          font-size: 10px; 
        }
        .chip-select::before { inset: 4px; }
        .btn-big { 
          padding: 14px; 
          font-size: 14px; 
        }
        
        /* Recent numbers */
        .history-coins { 
          grid-template-columns: repeat(5, 1fr); 
          gap: 6px; 
        }
        .coin-slot { font-size: 10px; }
        
        /* Leaderboard mobile */
        .leaderboard-header { 
          grid-template-columns: 2fr 1fr 1fr 1fr; 
          font-size: 8px;
          padding: 6px 8px;
        }
        .leaderboard-header > div:nth-child(2),
        .leaderboard-header > div:nth-child(4) { display: none; }
        .leaderboard-row { 
          grid-template-columns: 2fr 1fr 1fr 1fr; 
          padding: 8px;
          font-size: 10px;
        }
        .leaderboard-row > div:nth-child(2),
        .leaderboard-row > div:nth-child(4) { display: none; }
        
        /* Chat mobile */
        .chat-msgs { padding: 10px; font-size: 11px; }
        .chat-row { padding: 6px; margin-bottom: 8px; }
        
        /* Panel headers */
        .panel-head { padding: 10px 12px; font-size: 10px; }
        .tabs .tab { padding: 10px 6px; font-size: 9px; }
        
        /* Total bet display */
        .total-bet-display { padding: 8px 10px; }
        .total-bet-value { font-size: 16px; }
      }
      
      /* SMALL MOBILE */
      @media (max-width: 380px) {
        header { padding: 8px; }
        .balance-main { padding: 6px 12px; }
        .balance-amount { font-size: 14px; }
        .stat-box { padding: 4px 8px; }
        
        .dashboard { padding: 8px; gap: 8px; }
        
        .wheel-stage { margin-top: -120px; }
        .wheel-mask { 
          width: 85vw; 
          height: 85vw;
          max-width: 280px;
          max-height: 280px;
        }
        
        .table-layout {
          grid-template-columns: 30px repeat(12, 26px) 30px;
          gap: 2px;
        }
        .cell { height: 30px; font-size: 10px; }
        
        .chips-area { gap: 4px; }
        .chip-select { font-size: 9px; }
      }
      
      /* Touch-friendly adjustments */
      @media (hover: none) and (pointer: coarse) {
        .cell { min-height: 44px; }
        .chip-select { min-width: 44px; min-height: 44px; }
        .btn-big { min-height: 48px; }
        .stat-box { min-height: 44px; }
      }
      
      /* MODAL STYLES */
      .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        backdrop-filter: blur(5px);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 9999;
        animation: fadeIn 0.2s ease;
      }
      .modal-overlay.show {
        display: flex;
      }
      @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
      }
      .modal-content {
        background: var(--bg-panel);
        border-radius: 16px;
        border: 1px solid rgba(255,255,255,0.1);
        box-shadow: 0 20px 60px rgba(0,0,0,0.5);
        max-width: 600px;
        width: 90%;
        max-height: 80vh;
        overflow-y: auto;
        animation: slideUp 0.3s ease;
      }
      @keyframes slideUp {
        from { transform: translateY(30px); opacity: 0; }
        to { transform: translateY(0); opacity: 1; }
      }
      .modal-header {
        padding: 20px 24px;
        border-bottom: 1px solid rgba(255,255,255,0.05);
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      .modal-title {
        font-size: 18px;
        font-weight: 700;
        color: var(--text-main);
      }
      .modal-close {
        width: 32px;
        height: 32px;
        border-radius: 8px;
        background: rgba(255,255,255,0.05);
        border: none;
        color: #999;
        font-size: 20px;
        cursor: pointer;
        transition: all 0.2s;
      }
      .modal-close:hover {
        background: rgba(255,255,255,0.1);
        color: #fff;
      }
      .modal-body {
        padding: 24px;
      }
      
      /* Avatar Selection */
      .avatar-grid {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 20px;
        max-height: 65vh;
        overflow-y: auto;
        padding: 12px;
      }
      .avatar-option {
        position: relative;
        width: 100%;
        padding-bottom: 100%; /* Cria aspect ratio 1:1 */
        border-radius: 16px;
        background: var(--bg-element);
        border: 3px solid transparent;
        cursor: pointer;
        transition: all 0.2s;
        overflow: hidden;
      }
      .avatar-option img {
        position: absolute;
        top: 12px;
        left: 12px;
        right: 12px;
        bottom: 12px;
        width: calc(100% - 24px);
        height: calc(100% - 24px);
        object-fit: cover;
        border-radius: 8px;
      }
      .avatar-option:hover {
        background: rgba(255,255,255,0.1);
        transform: scale(1.05);
        border-color: rgba(249, 115, 22, 0.3);
      }
      .avatar-option.selected {
        border-color: var(--accent);
        background: rgba(249, 115, 22, 0.1);
        box-shadow: 0 0 15px rgba(249, 115, 22, 0.3);
      }
      
      /* Settings Form */
      .settings-group {
        margin-bottom: 24px;
      }
      .settings-label {
        display: block;
        font-size: 11px;
        font-weight: 700;
        text-transform: uppercase;
        color: var(--text-muted);
        margin-bottom: 8px;
        letter-spacing: 1px;
      }
      .settings-input {
        width: 100%;
        padding: 12px 14px;
        background: var(--bg-element);
        border: 1px solid rgba(255,255,255,0.05);
        border-radius: 10px;
        color: var(--text-main);
        font-size: 13px;
        font-family: monospace;
        transition: all 0.2s;
      }
      .settings-input:focus {
        outline: none;
        border-color: var(--accent);
        box-shadow: 0 0 0 3px rgba(249, 115, 22, 0.1);
      }
      .settings-hint {
        font-size: 10px;
        color: #666;
        margin-top: 6px;
      }
      .settings-buttons {
        display: flex;
        gap: 12px;
        margin-top: 24px;
      }
      .modal-btn {
        flex: 1;
        padding: 12px;
        border-radius: 10px;
        border: none;
        font-weight: 700;
        font-size: 12px;
        text-transform: uppercase;
        cursor: pointer;
        transition: all 0.2s;
      }
      .modal-btn-primary {
        background: linear-gradient(to bottom, var(--accent), #ea580c);
        color: #fff;
        box-shadow: 0 4px 12px rgba(234, 88, 12, 0.4);
      }
      .modal-btn-primary:hover {
        filter: brightness(1.1);
        transform: translateY(-1px);
      }
      .modal-btn-secondary {
        background: var(--bg-element);
        color: var(--text-muted);
      }
      .modal-btn-secondary:hover {
        background: rgba(255,255,255,0.1);
        color: var(--text-main);
      }
      
      /* Deposit Modal Styles */
      .deposit-amounts {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 12px;
        margin-bottom: 20px;
      }
      .deposit-amount-btn {
        padding: 16px;
        background: var(--bg-element);
        border: 2px solid rgba(255,255,255,0.05);
        border-radius: 12px;
        color: var(--text-main);
        font-size: 16px;
        font-weight: 700;
        cursor: pointer;
        transition: all 0.2s;
        text-align: center;
      }
      .deposit-amount-btn:hover {
        background: rgba(255,255,255,0.08);
        border-color: var(--accent);
        transform: translateY(-2px);
      }
      .deposit-amount-btn.selected {
        background: linear-gradient(135deg, rgba(245,158,11,0.2), rgba(234,88,12,0.1));
        border-color: var(--accent);
        box-shadow: 0 0 20px rgba(245,158,11,0.3);
      }
      .deposit-amount-btn .amount {
        font-size: 20px;
        color: var(--gold-2);
        display: block;
        margin-bottom: 4px;
      }
      .deposit-amount-btn .bonus {
        font-size: 10px;
        color: #22c55e;
        text-transform: uppercase;
      }
      .payment-methods {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 12px;
        margin-bottom: 20px;
      }
      .payment-method {
        padding: 16px;
        background: var(--bg-element);
        border: 2px solid rgba(255,255,255,0.05);
        border-radius: 12px;
        cursor: pointer;
        transition: all 0.2s;
        display: flex;
        align-items: center;
        gap: 12px;
      }
      .payment-method:hover {
        background: rgba(255,255,255,0.08);
        border-color: var(--accent);
      }
      .payment-method.selected {
        background: linear-gradient(135deg, rgba(245,158,11,0.2), rgba(234,88,12,0.1));
        border-color: var(--accent);
        box-shadow: 0 0 20px rgba(245,158,11,0.3);
      }
      .payment-method-icon {
        width: 40px;
        height: 40px;
        border-radius: 8px;
        background: rgba(255,255,255,0.05);
        display: grid;
        place-items: center;
        font-size: 20px;
      }
      .payment-method-info {
        flex: 1;
      }
      .payment-method-name {
        font-size: 13px;
        font-weight: 700;
        color: var(--text-main);
        margin-bottom: 2px;
      }
      .payment-method-desc {
        font-size: 10px;
        color: var(--text-muted);
      }
      .deposit-summary {
        background: linear-gradient(145deg, rgba(34,197,94,0.1), rgba(22,163,74,0.05));
        border: 1px solid rgba(34,197,94,0.3);
        border-radius: 12px;
        padding: 16px;
        margin-bottom: 20px;
      }
      .deposit-summary-row {
        display: flex;
        justify-content: space-between;
        margin-bottom: 8px;
        font-size: 13px;
      }
      .deposit-summary-row:last-child {
        margin-bottom: 0;
        padding-top: 8px;
        border-top: 1px solid rgba(34,197,94,0.2);
        font-size: 16px;
        font-weight: 700;
      }
      .deposit-summary-label {
        color: var(--text-muted);
      }
      .deposit-summary-value {
        color: var(--text-main);
        font-weight: 600;
      }
      .deposit-summary-value.total {
        color: #22c55e;
        font-size: 18px;
      }
      .card-form {
        display: none;
      }
      .card-form.active {
        display: block;
      }
      .card-input-group {
        margin-bottom: 16px;
      }
      .card-input-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 12px;
      }
      .pix-qrcode {
        display: none;
        text-align: center;
        padding: 20px;
      }
      .pix-qrcode.active {
        display: block;
      }
      .qr-placeholder {
        width: 200px;
        height: 200px;
        margin: 0 auto 16px;
        background: #fff;
        border-radius: 12px;
        display: grid;
        place-items: center;
        font-size: 80px;
      }
      .pix-code {
        background: var(--bg-element);
        border: 1px solid rgba(255,255,255,0.1);
        border-radius: 8px;
        padding: 12px;
        font-family: monospace;
        font-size: 11px;
        word-break: break-all;
        margin-bottom: 12px;
        color: var(--text-muted);
      }
      .processing-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0,0,0,0.9);
        backdrop-filter: blur(10px);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 10000;
      }
      .processing-overlay.active {
        display: flex;
      }
      .processing-content {
        text-align: center;
        padding: 40px;
      }
      .processing-spinner {
        width: 60px;
        height: 60px;
        border: 4px solid rgba(245,158,11,0.2);
        border-top-color: var(--accent);
        border-radius: 50%;
        margin: 0 auto 20px;
        animation: spin 1s linear infinite;
      }
      @keyframes spin {
        to { transform: rotate(360deg); }
      }
      .processing-text {
        font-size: 18px;
        font-weight: 700;
        color: var(--text-main);
        margin-bottom: 8px;
      }
      .processing-subtext {
        font-size: 13px;
        color: var(--text-muted);
      }
      .success-checkmark {
        width: 80px;
        height: 80px;
        margin: 0 auto 20px;
        border-radius: 50%;
        background: linear-gradient(135deg, #22c55e, #16a34a);
        display: grid;
        place-items: center;
        font-size: 40px;
        animation: scaleIn 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      }
      @keyframes scaleIn {
        0% { transform: scale(0); }
        100% { transform: scale(1); }
      }
      
      /* MODAL MOBILE */
      @media (max-width: 768px) {
        .modal-content {
          width: 95%;
          max-height: 90vh;
          border-radius: 12px;
        }
        .modal-header { padding: 14px 16px; }
        .modal-title { font-size: 16px; }
        .modal-body { padding: 16px; }
        
        .avatar-grid {
          grid-template-columns: repeat(4, 1fr);
          gap: 12px;
          max-height: 50vh;
        }
        .avatar-option { border-radius: 12px; }
        
        .settings-group { margin-bottom: 16px; }
        .settings-input { padding: 10px 12px; font-size: 12px; }
        .settings-buttons { gap: 8px; }
        .modal-btn { padding: 10px; font-size: 11px; }
        
        .deposit-amounts {
          grid-template-columns: repeat(2, 1fr);
          gap: 8px;
        }
        .deposit-amount-btn { padding: 12px; }
        .deposit-amount-btn .amount { font-size: 16px; }
        .deposit-amount-btn .bonus { font-size: 9px; }
        
        .payment-methods { grid-template-columns: 1fr; gap: 8px; }
        .payment-method { padding: 12px; }
        .payment-method-icon { width: 32px; height: 32px; font-size: 16px; }
        
        .card-input-row { grid-template-columns: 1fr 1fr; gap: 8px; }
        
        .qr-placeholder { width: 160px; height: 160px; font-size: 60px; }
        .pix-code { font-size: 10px; padding: 10px; }
        
        .deposit-summary { padding: 12px; }
        .deposit-summary-row { font-size: 12px; }
        
        .processing-content { padding: 24px; }
        .processing-spinner { width: 48px; height: 48px; }
        .processing-text { font-size: 16px; }
      }
      
      @media (max-width: 380px) {
        .avatar-grid { grid-template-columns: repeat(3, 1fr); gap: 8px; }
        .deposit-amounts { grid-template-columns: 1fr; }
      }
    </style>
  </head>
  <body>

    <header>
      <div class="brand">
        <svg viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
          <defs>
            <linearGradient id="g1" x1="0" y1="0" x2="1" y2="1"><stop offset="0" stop-color="#bf953f"/><stop offset="0.5" stop-color="#fcf6ba"/><stop offset="1" stop-color="#b38728"/></linearGradient>
          </defs>
          <path d="M28 4A24 24 0 0 0 28 60" stroke="url(#g1)" stroke-width="2" stroke-dasharray="4 2"/>
          <path d="M42 16C30 16 30 26 42 26 54 26 54 44 36 44L32 44" stroke="url(#g1)" stroke-width="5" stroke-linecap="round"/>
          <path d="M32 24C44 24 44 6 26 6L22 6" stroke="url(#g1)" stroke-width="5" stroke-linecap="round"/>
          <path d="M24 44L24 54M24 44C24 44 18 50 18 40 18 36 24 32 24 32 24 32 30 36 30 40 30 50 24 44 24 44Z" fill="url(#g1)"/>
        </svg>
        <div class="brand-text">
          <span class="brand-title">Strenger</span>
          <span class="brand-subtitle">Roulette</span>
        </div>
      </div>
        <div class="balance-main">
          <div class="balance-icon" id="btnAddFunds" style="cursor:pointer;transition:all 0.2s;" title="Add Funds">üí∞</div>
          <span class="balance-amount" id="balance">$1,000.00</span>
        </div>
      <div class="user-stats">
        <div class="stat-box" id="btnConnect" style="padding:8px 12px;gap:10px;cursor:pointer;height:54px;">
          <div id="dot" style="width:8px;height:8px;border-radius:50%;background:#ef4444;"></div>
          <span id="connText">Offline</span>
        </div>
        <div class="stat-box" id="settingsBtn" style="padding:8px 12px;justify-content:center;cursor:pointer;font-size:20px;height:54px;aspect-ratio:1;" title="Settings">‚öôÔ∏è</div>
        <div class="stat-box" style="padding:8px 12px;gap:10px;cursor:pointer;transition:all 0.2s;height:54px;" onclick="openModal('avatarModal')" title="Click to change profile">
          <div id="userAvatar" style="width:38px;height:38px;border-radius:50%;padding:2px;justify-content:center;font-weight:700;font-size:18px;overflow:hidden;flex-shrink:0;display:flex;align-items:center;">
            <span id="userId">U</span>
          </div>
          <div style="display:flex;flex-direction:column;line-height:1.2;">
            <span id="displayUsername" style="font-size:13px;font-weight:600;color:#e5e7eb;">User</span>
            <span style="font-size:9px;color:#666;text-transform:uppercase;letter-spacing:0.5px;">Player</span>
          </div>
        </div>
      </div>
    </header>

    <div class="dashboard">
      <div class="left-column">
      <aside class="panel">
        <div class="panel-head"><span>Active Players</span><span style="color:var(--accent)" id="playerCount">21</span></div>
        <div class="panel-body" id="playerList"></div>
      </aside>
      </div>

      <section class="game-area">
        <div class="wheel-stage">
          <div class="wheel-mask">
            <div class="pointer"></div>
            <div class="wheel" id="wheel">
              <div class="numbers" id="numbers"></div>
              <div class="pockets" id="pockets"></div>
            </div>
            <!-- Indicador fixo em 6 horas -->
            <div class="wheel-indicator" id="wheelIndicator">
              <div class="wheel-indicator-base"></div>
            </div>
            <div class="result-overlay" id="resultOverlay">
              <div class="result-text" id="resultText">WIN</div>
            </div>
          </div>
        </div>

        <div class="table-container">
          <div class="table-layout" id="tableGrid"></div>
        </div>
      </section>

      <div class="right-column">
      <aside class="panel">
        <div class="panel-head">Betting Controls</div>
        <div class="panel-body controls-body">
          <div class="mode-toggle">
            <div class="mode-btn active" id="btnManual">Manual</div>
            <div class="mode-btn" id="btnAuto">Auto</div>
          </div>
          
          <div>
            <span class="label">Bet Amount</span>
            <input type="number" class="bet-input" id="betInput" value="10" step="5" min="5" max="10000">
            <div class="bet-limits">
              <span>Min bet: $5</span>
              <span>Max bet: $10K</span>
            </div>
          </div>
          
          <div>
            <span class="label">Chip Value</span>
            <div class="chips-area">
              <div class="chip-select chip-purple active" data-val="10">10</div>
              <div class="chip-select chip-blue" data-val="25">25</div>
              <div class="chip-select chip-green" data-val="50">50</div>
              <div class="chip-select chip-red" data-val="100">100</div>
              <div class="chip-select chip-gold" data-val="250">250</div>
              <div class="chip-select chip-blue" data-val="500">500</div>
              <div class="chip-select chip-green" data-val="1000">1K</div>
              <div class="chip-select chip-red" data-val="5000">5K</div>
              <div class="chip-select chip-purple" data-val="10000">10K</div>
              <div class="chip-select chip-clear" id="btnClear">‚úï</div>
            </div>
          </div>
          
          <!-- Total Bet Display -->
          <div class="total-bet-display" id="totalBetDisplay">
            <div class="total-bet-label">Total Bet on Table</div>
            <div class="total-bet-value">$0.00</div>
          </div>
          
          <button class="btn-big" id="btnAction">Place Bet</button>
          </div>
        </aside>
        
        <aside class="panel">
          <div class="panel-head">Recent Numbers</div>
          <div class="panel-body" style="padding: 8px; overflow: hidden;">
            <div class="history-coins" id="historyCoins"></div>
            </div>
        </aside>
          </div>
          
      <aside class="panel top-players-full">
        <div class="panel-head">
          <span>Recent Bets & Results <span id="liveDot" style="display:none;color:#22c55e;font-size:8px;vertical-align:middle;">‚óè LIVE</span></span>
          <span style="color:var(--accent)" id="totalBets">0 bets</span>
        </div>
        <div class="tabs">
          <div class="tab active">All Bets</div>
          <div class="tab">Wins Only</div>
          <div class="tab">My Bets</div>
          </div>
        <div class="panel-body" style="padding: 0;">
          <div class="leaderboard">
            <div class="leaderboard-header">
              <div>User</div>
              <div>Time</div>
              <div>Number</div>
              <div>Bet Amount</div>
              <div>Result</div>
              <div>Profit/Loss</div>
        </div>
            <div id="betsLog">
              <!-- Bets will be added here dynamically -->
            </div>
          </div>
        </div>
      </aside>
      
      <aside class="panel chat-extended">
          <div class="panel-head">
            <span>Live Chat <span class="live-indicator" id="chatLiveDot" style="display:none;">‚óè LIVE</span></span>
            <span style="color:var(--accent)" id="chatViewers">0 üëÅ</span>
          </div>
        <div class="panel-body" style="padding: 0; display: flex; flex-direction: column;">
          <div class="chat-msgs" id="chatBox">
            <div class="chat-row">
              <div style="margin-bottom:4px"><span style="color:#60a5fa;font-weight:600">Daniel Allison</span> <span style="color:#555;font-size:9px;margin-left:6px">3:27 pm</span></div>
              <span style="color:#d1d5db">Why does it seem like everyone's betting on black lol! My big chips are on reds, and it feels like my lucky day today üé∞üí∞</span>
            </div>
            <div class="chat-row">
              <div style="margin-bottom:4px"><span style="color:#a78bfa;font-weight:600">Nwamaka Diana</span> <span style="color:#555;font-size:9px;margin-left:6px">3:28 pm</span></div>
              <span style="color:#d1d5db">Lmao! You can't be so sureüòÇüòÇ It'd have been nicer if we could bet in stable coins üí∞üî•</span>
            </div>
            <div class="chat-row">
              <div style="margin-bottom:4px"><span style="color:#34d399;font-weight:600">Mario Francis</span> <span style="color:#555;font-size:9px;margin-left:6px">3:30 pm</span></div>
              <span style="color:#d1d5db">defs loving the commVQUnity experience on this product!üî•</span>
            </div>
          </div>
          <div style="display:flex;align-items:center;background:#0b0d10;border-top:1px solid #222;padding:8px 12px">
            <input class="chat-input" placeholder="Say something..." style="border:none;padding:0;border-top:none;background:transparent">
            <button style="background:var(--accent);border:none;color:#fff;width:32px;height:32px;border-radius:10px;cursor:pointer;font-size:16px;display:grid;place-items:center">‚û§</button>
          </div>
        </div>
      </aside>
    </div>

  <script>
  (() => {
    /* STRENGER CASINO - ROULETTE FRONTEND */
    const DEBUG = false; // Set to true for verbose logging
    const log = (...args) => DEBUG && console.log(...args);
    const logError = (...args) => console.error(...args);
    
    /* CONFIG */
    const $ = id => document.getElementById(id);
    const WHEEL = [0,32,15,19,4,21,2,25,17,34,6,27,13,36,11,30,8,23,10,5,24,16,33,1,20,14,31,9,22,18,29,7,28,12,35,3,26];
    const REDS = new Set([1,3,5,7,9,12,14,16,18,19,21,23,25,27,30,32,34,36]);
    const SEG = 360 / 37;
    
    // Carrega configura√ß√µes salvas do localStorage
    let WS_URL = localStorage.getItem('wsUrl') || "ws://ws-gw-qxtrdq.ekvjny.bra-s1.cloudhub.io/ws";
    let API_URL = localStorage.getItem('apiUrl') || "http://ws-gw-qxtrdq.ekvjny.bra-s1.cloudhub.io/api";
    
    // Gera lista de avatares dinamicamente (1-35)
    const AVATARS = Array.from({length: 35}, (_, i) => `https://cdn.jsdelivr.net/gh/alohe/avatars/png/memo_${i+1}.png`);
    
    // N√£o carrega avatar do localStorage - cada aba come√ßa sem avatar (apenas inicial)
    let selectedAvatar = null; 
    
    // SEMPRE gera username aleat√≥rio para cada aba/sess√£o (entre 100-9999)
    let username = 'user' + Math.floor(Math.random() * (9999 - 100 + 1) + 100);
    
    // Gera sessionId √∫nico para esta aba (n√£o persiste no localStorage)
    let sessionId = 'tab_' + Date.now() + '_' + Math.floor(Math.random()*999999);
    let pid = username + '_' + sessionId; // userId √∫nico para backend
    
    log('üÜî Session:', username, '| pid:', pid);

    let ws=null, spinning=false, bal=0, chip=10, bets=new Map();
    let audioCtx=null, autoMode=false, spinTimeout=null, autoSpinTimeout=null;
    let betsLog = []; // Armazena hist√≥rico de apostas
    
    // Mapeamento de valor do chip para cor
    const chipColors = {
      10: 'purple',
      25: 'blue',
      50: 'green',
      100: 'red',
      250: 'gold',
      500: 'blue',
      1000: 'green',
      5000: 'red',
      10000: 'purple'
    };
    let currentBetAmount = 0; // Armazena valor da aposta atual
    let autoSpinDelay = 2000; // Delay entre spins autom√°ticos (2 segundos)
    let soundEnabled = localStorage.getItem('soundEnabled') !== 'false';
    log('üîä Sound:', soundEnabled);

    const playTick = () => {
      if(!soundEnabled) return;
      if(!audioCtx) audioCtx = new (window.AudioContext||window.webkitAudioContext)();
      if(audioCtx.state==='suspended') audioCtx.resume();
      const o=audioCtx.createOscillator(), g=audioCtx.createGain();
      o.connect(g); g.connect(audioCtx.destination);
      o.frequency.setValueAtTime(800, audioCtx.currentTime);
      o.frequency.exponentialRampToValueAtTime(1200, audioCtx.currentTime+0.01);
      g.gain.setValueAtTime(0.05, audioCtx.currentTime);
      g.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime+0.03);
      o.start(); o.stop(audioCtx.currentTime+0.04);
    };

    const fmt = v => '$' + v.toLocaleString('en-US', {minimumFractionDigits:2, maximumFractionDigits:2});
    
    // Calcula b√¥nus baseado no valor do dep√≥sito
    const calcBonus = amt => amt >= 10000 ? 25 : amt >= 5000 ? 20 : amt >= 2500 ? 15 : amt >= 1000 ? 10 : amt >= 500 ? 5 : 0;
    
    // Extrai username do userId (remove sessionId)
    // Ex: "user123_tab_1234567_890" ‚Üí "user123"
    function extractUsername(userId) {
      if(!userId) return 'Unknown';
      const parts = userId.split('_tab_');
      return parts[0]; // Retorna apenas a parte antes de "_tab_"
    }
    
    function updateUI() {
      // Mostra avatar ou inicial no header
      const userIdElement = $('userId');
      if(userIdElement) {
        if(selectedAvatar && selectedAvatar.startsWith('http')) {
          // Avatar com imagem
          userIdElement.innerHTML = `<img src="${selectedAvatar}" alt="Avatar" style="width:100%;height:100%;object-fit:cover;border-radius:50%;">`;
        } else if(selectedAvatar) {
          // Fallback para emoji/texto
          userIdElement.textContent = selectedAvatar;
        } else {
          // Sem avatar - mostra apenas a inicial
          userIdElement.textContent = username[0].toUpperCase();
        }
      }
      
      // Atualiza cor de fundo do avatar com a cor do chat
      const userColor = getUserColor(pid);
      const avatarElement = $('userAvatar');
      if(avatarElement) {
        avatarElement.style.background = userColor;
      }
      
      // Atualiza nome do usu√°rio no header
      const displayUsernameElement = $('displayUsername');
      if(displayUsernameElement) {
        displayUsernameElement.textContent = username;
      }
      
      $('balance').textContent = fmt(bal);
      $('btnAction').textContent = spinning ? "SPINNING..." : "PLACE BET"; $('btnAction').disabled = spinning;
      
      // Calcula total de apostas
      let totalBet = 0;
      bets.forEach(v => totalBet += v);
      
      // Atualiza display de Total Bet
      const totalBetDisplay = $('totalBetDisplay');
      const totalBetValue = totalBetDisplay.querySelector('.total-bet-value');
      if(totalBetValue) {
        totalBetValue.textContent = fmt(totalBet);
        
        // Adiciona destaque se tem apostas
        if(totalBet > 0) {
          totalBetDisplay.classList.add('has-bets');
        } else {
          totalBetDisplay.classList.remove('has-bets');
        }
      }
      
      document.querySelectorAll('.chip-render').forEach(e=>e.remove());
      document.querySelectorAll('.cell.win-anim').forEach(e=>e.classList.remove('win-anim'));
      bets.forEach((amt, k) => {
        const [t, v] = k.split(':');
        const el = document.querySelector(`.cell[data-k="${t}"][data-v="${v}"]`);
        if(el) {
          const c = document.createElement('div');
          
          // Determina a cor baseada no chip selecionado
          const chipColor = chipColors[chip] || 'default';
          c.className = `chip-render chip-render-${chipColor}`;
          
          // Formata o valor
          c.textContent = amt >= 1000 ? (amt/1000).toFixed(1)+'k' : amt;
          
          el.appendChild(c);
        }
      });
    }

    function addBet(k, v, m=1) {
      if(spinning) return;
      const key = `${k}:${v}`;
      const next = (bets.get(key)||0) + (chip * m);
      if(next<=0) bets.delete(key); else bets.set(key, next);
      updateUI();
    }

    /* --- TABLE BUILDER --- */
    function buildTable() {
      const grid = $('tableGrid');
      
      // 1. ZERO
      grid.appendChild(mkCell('0', 'c-zero c-green', 'number', '0'));

      // 2. NUMBERS
      const rows = [3,2,1];
      for(let r=0; r<3; r++) {
        for(let c=0; c<12; c++) {
          const n = rows[r] + (c*3);
          grid.appendChild(mkCell(n, REDS.has(n)?'c-red':'c-black', 'number', n));
        }
        grid.appendChild(mkCell('2:1', 'c-2to1', 'col', 3-r));
      }

      // 3. DOZENS
      grid.appendChild(mkSpacer()); 
      grid.appendChild(mkCell('1st 12', 'c-dozen', 'dozen', '1-12'));
      grid.appendChild(mkCell('2nd 12', 'c-dozen', 'dozen', '13-24'));
      grid.appendChild(mkCell('3rd 12', 'c-dozen', 'dozen', '25-36'));
      grid.appendChild(mkSpacer()); 

      // 4. SIMPLE
      grid.appendChild(mkSpacer());
      grid.appendChild(mkCell('1-18', 'c-simple', 'simple', '1-18'));
      grid.appendChild(mkCell('EVEN', 'c-simple', 'simple', 'EVEN'));
      grid.appendChild(mkCell('RED', 'c-simple red-btn', 'simple', 'RED'));
      grid.appendChild(mkCell('BLACK', 'c-simple black-btn', 'simple', 'BLACK'));
      grid.appendChild(mkCell('ODD', 'c-simple', 'simple', 'ODD'));
      grid.appendChild(mkCell('19-36', 'c-simple', 'simple', '19-36'));
      grid.appendChild(mkSpacer());
    }

    function mkCell(lbl, cls, k, v) {
      const d = document.createElement('div');
      d.className = `cell ${cls}`; d.textContent = lbl;
      d.dataset.k = k; d.dataset.v = v;
      d.onclick = e => addBet(k, v, e.altKey?-1:1);
      return d;
    }
    function mkSpacer() { const d=document.createElement('div'); d.className='spacer-zero'; return d; }

    /* --- WHEEL --- */
    const wheel=$('wheel');
    const wheelIndicator=$('wheelIndicator');

    function initWheel() {
      const container = $('numbers');
      const pocketsContainer = $('pockets');
      
      // Create all 37 numbers in full circular layout
      const anglePerPocket = 360 / 37;
      const radiusPercent = 42.5; // Percentage of container size
      
      for(let i = 0; i < WHEEL.length; i++) {
        const n = WHEEL[i];
        const angle = i * anglePerPocket;
        
        // Create number cell
        const cell = document.createElement('div');
        cell.className = 'num';
        cell.textContent = n;
        cell.dataset.number = n;
        cell.dataset.angle = angle;
        
        // Add color class based on number type
        if(n === 0) {
          cell.classList.add('green');
        } else if(REDS.has(n)) {
          cell.classList.add('red');
        } else {
          cell.classList.add('black');
        }
        
        // Calculate position using trigonometry (percentages)
        const radians = (angle - 90) * (Math.PI / 180); // -90 so 0¬∞ is at top
        const xPercent = radiusPercent * Math.cos(radians);
        const yPercent = radiusPercent * Math.sin(radians);
        
        // Position using percentages for responsive sizing
        cell.style.left = `calc(50% + ${xPercent}%)`;
        cell.style.top = `calc(50% + ${yPercent}%)`;
        cell.style.transform = `translate(-50%, -50%) rotate(${angle}deg)`;
        
        // Create inner span to rotate the number text only
        const numberSpan = document.createElement('span');
        numberSpan.textContent = cell.textContent;
        numberSpan.style.display = 'inline-block';
        numberSpan.style.transform = 'rotate(180deg)';
        cell.textContent = '';
        cell.appendChild(numberSpan);
        
        container.appendChild(cell);
        
        // Create divider line between pockets
        const line = document.createElement('div');
        line.className = 'pocket';
        line.style.transform = `rotate(${angle}deg)`;
        pocketsContainer.appendChild(line);
      }
    }

    let wheelRotation = 0;
    let wheelSpeed = 0; // Velocidade atual da wheel (graus/segundo)
    let wheelRAF = 0;
    let wheelLastTs = 0;
    let wheelTargetNumber = null; // N√∫mero que deve parar
    let wheelStopTime = 0; // Quando come√ßar a parar
    let wheelStartStopTime = 0; // Momento em que come√ßou a parar
    
    let lastSector = -1; // √öltimo setor para detectar mudan√ßa e fazer tick
    let isSpinning = false;

    // Inicia rota√ß√£o cont√≠nua da wheel (sem saber o n√∫mero ainda)
    function startWheelSpin() {
      if(isSpinning) return;
      
      isSpinning = true;
      wheelTargetNumber = null;
      wheelSpeed = 720; // 720¬∞/s = 2 rota√ß√µes por segundo
      wheelLastTs = 0;
      wheelStopTime = 0;
      lastSector = -1;
      log('üé° Wheel spinning - waiting for result');
      
      cancelAnimationFrame(wheelRAF);
      
      let targetRotation = 0;
      let startRotation = 0;
      let stopStartTime = 0;
      
      function tick(ts) {
        if(!isSpinning) return;
        
        if(!wheelLastTs) wheelLastTs = ts;
        const dt = (ts - wheelLastTs) / 1000; // delta em segundos
        wheelLastTs = ts;
        
        // Se j√° recebeu o n√∫mero, come√ßa a desacelerar
        if(wheelTargetNumber !== null) {
          const stopDuration = 4000; // 4 segundos para parar
          
          if(wheelStopTime === 0) {
            wheelStopTime = ts;
            stopStartTime = ts;
            startRotation = wheelRotation;
            
            // Calcula onde deve parar
            const targetIndex = WHEEL.indexOf(wheelTargetNumber);
            const anglePerNumber = 360 / 37;
            const numberInitialAngle = targetIndex * anglePerNumber;
            const targetPosition = 180; // 6 horas
            
            // Posi√ß√£o atual do n√∫mero
            const currentNumberPosition = ((numberInitialAngle + wheelRotation) % 360 + 360) % 360;
            
            // Quanto precisa girar para chegar a 180¬∞
            let angleToTarget = ((targetPosition - currentNumberPosition) + 360) % 360;
            
            // Adiciona pelo menos 2 voltas extras
            if(angleToTarget < 180) angleToTarget += 720;
            else angleToTarget += 360;
            
            targetRotation = wheelRotation + angleToTarget;
            log('üéØ Stop:', wheelTargetNumber, '| Rot:', targetRotation.toFixed(1), '¬∞');
          }
          
          const elapsed = ts - stopStartTime;
          const stopProgress = Math.min(elapsed / stopDuration, 1);
          
          if(stopProgress < 1) {
            // Easing suave (ease-out cubic)
            const eased = 1 - Math.pow(1 - stopProgress, 3);
            wheelRotation = startRotation + (targetRotation - startRotation) * eased;
          } else {
            // Parou - garante posi√ß√£o exata
            wheelRotation = targetRotation;
            wheelSpeed = 0;
            isSpinning = false;
            
            // Verifica posi√ß√£o final
            const targetIndex = WHEEL.indexOf(wheelTargetNumber);
            const anglePerNumber = 360 / 37;
            const numberInitialAngle = targetIndex * anglePerNumber;
            const finalNumberPosition = ((numberInitialAngle + wheelRotation) % 360 + 360) % 360;
            log('‚úÖ WHEEL STOPPED:', wheelTargetNumber, '@', finalNumberPosition.toFixed(1), '¬∞');
            highlightWinningNumber(wheelTargetNumber);
            playTick();
          }
        } else {
          // Girando em velocidade constante
          wheelRotation += wheelSpeed * dt;
        }
        
        // Som de tick quando n√∫mero passa pelo indicador (6 horas = 180¬∞)
        // Calcula qual n√∫mero est√° em 180¬∞ agora
        const currentSector = Math.floor(((180 - wheelRotation % 360 + 360) % 360) / SEG);
        if(lastSector !== -1 && currentSector !== lastSector) {
          playTick();
          // Efeito visual no indicador
          wheelIndicator.classList.add('active');
          setTimeout(() => wheelIndicator.classList.remove('active'), 50);
        }
        lastSector = currentSector;
        
        wheel.style.transform = `rotate(${wheelRotation}deg)`;
        wheelRAF = requestAnimationFrame(tick);
      }
      
      wheelRAF = requestAnimationFrame(tick);
    }
    
    // Recebe o n√∫mero vencedor e agenda a parada
    function stopWheelAt(targetNumber) {
      if(!isSpinning || wheelTargetNumber !== null) return;
      wheelTargetNumber = targetNumber;
      log('üéØ Target:', targetNumber);
    }

    function highlightWinningNumber(num) {
      document.querySelectorAll('.num.active').forEach(el => el.classList.remove('active'));
      const winningCell = document.querySelector(`.num[data-number="${num}"]`);
      if(winningCell) {
        winningCell.classList.add('active');
      }
    }

    function stopWheel() {
      isSpinning = false;
      cancelAnimationFrame(wheelRAF);
      wheelRAF = 0;
      wheelSpeed = 0;
      wheelTargetNumber = null;
      wheelStopTime = 0;
      wheelStartStopTime = 0;
      lastSector = -1;
    }

    async function spin() {
      if(!ws||ws.readyState!==1){ connect(); return; }
      if(spinning) return;
      
      let total=0; 
      bets.forEach(v=>total+=v);
      
      if(total === 0) {
        alert('Please place a bet first');
        return;
      }
      
      if(total>bal){
        alert('Insufficient balance');
        return;
      }
      
      spinning=true;
      currentBetAmount = total; // Salva valor da aposta
      
      // Esconde overlay de resultado anterior
      const overlay = $('resultOverlay');
      if(overlay) overlay.classList.remove('show');
      
      // Limpa destaques anteriores
      document.querySelectorAll('.num.active').forEach(el => el.classList.remove('active'));
      
      // INICIA ROTA√á√ÉO CONT√çNUA (sem saber o n√∫mero ainda)
      startWheelSpin();
      
      updateUI();
      
      const betData = {
        eventType: 'BET',
        userId: pid,
        gameId: 'roulette-v1',
        amount: total,
        bets: Object.fromEntries(bets),
        timestamp: new Date().toISOString()
      };
      
      log('üì§ Bet:', total);
      ws.send(JSON.stringify(betData));
      updateUI();
      
      // Timeout de seguran√ßa (30 segundos)
      if(spinTimeout) clearTimeout(spinTimeout);
      spinTimeout = setTimeout(() => {
        if(spinning) {
          console.error('‚è±Ô∏è Timeout waiting for result');
          spinning = false;
          stopWheel(); // Para a anima√ß√£o f√≠sica da roleta
          updateUI();
          alert('Request timeout. Please try again.');
        }
      }, 30000);
    }

    function result(m) {
      if(!spinning) return;
      if(spinTimeout) { clearTimeout(spinTimeout); spinTimeout = null; }
      log('üì¶ Result:', m);
      
      // Extrai o n√∫mero ganhador
      let n = m.number ?? m.resultNumber ?? m.winningNumber;
      
      // Se n√£o tem n√∫mero mas tem a cor
      if((n === undefined || n === null) && m.result) {
        n = generateNumberFromColor(m.result);
      }
      
      // Converte para n√∫mero se vier como string
      if(typeof n === 'string') {
        n = parseInt(n, 10);
      }
      
      // Fallback para n√∫mero aleat√≥rio
      if(n === undefined || n === null || isNaN(n)) n = WHEEL[Math.floor(Math.random() * WHEEL.length)];
      log('üé≤ Result:', n, 'Win:', m.win);
      
      // Envia comando para parar no n√∫mero vencedor
      stopWheelAt(n);
      
      // Aguarda 5 segundos (4s de desacelera√ß√£o + 1s de margem) antes de finalizar
      setTimeout(() => {
        finish(n, m.win, m.newBalance, m);
      }, 5000);
    }
    
    function generateNumberFromColor(color) {
      // Gera n√∫mero aleat√≥rio baseado na cor
      if(color === 'GREEN') {
        return 0;
      } else if(color === 'RED') {
        const redNumbers = [1,3,5,7,9,12,14,16,18,19,21,23,25,27,30,32,34,36];
        return redNumbers[Math.floor(Math.random() * redNumbers.length)];
      } else if(color === 'BLACK') {
        const blackNumbers = [2,4,6,8,10,11,13,15,17,20,22,24,26,28,29,31,33,35];
        return blackNumbers[Math.floor(Math.random() * blackNumbers.length)];
      }
      return 0; // fallback
    }
    
    function showResultOverlay(isWin) {
      const overlay = $('resultOverlay');
      const text = $('resultText');
      
      if(!overlay || !text) return;
      
      text.textContent = isWin ? 'WIN' : 'LOSE';
      text.className = 'result-text ' + (isWin ? 'win' : 'lose');
      overlay.classList.add('show');
      setTimeout(() => overlay.classList.remove('show'), 3000);
      
      // Anima√ß√£o de confetti quando ganha
      if(isWin) {
        spawnConfetti();
      }
    }
    
    // Cria confetti caindo do topo
    function spawnConfetti() {
      const colors = [
        '#f59e0b', // gold
        '#fbbf24', // yellow
        '#ef4444', // red
        '#22c55e', // green
        '#3b82f6', // blue
        '#a855f7', // purple
        '#ec4899', // pink
        '#ffffff', // white
      ];
      const shapes = ['square', 'circle', 'ribbon'];
      const numConfetti = 60 + Math.floor(Math.random() * 40); // 60-100 confetti
      
      for(let i = 0; i < numConfetti; i++) {
        setTimeout(() => {
          const confetti = document.createElement('div');
          const shape = shapes[Math.floor(Math.random() * shapes.length)];
          const color = colors[Math.floor(Math.random() * colors.length)];
          
          confetti.className = 'confetti ' + shape;
          confetti.style.background = color;
          confetti.style.left = (Math.random() * 100) + 'vw';
          confetti.style.top = '-20px';
          
          // Varia√ß√µes na anima√ß√£o
          const duration = 2 + Math.random() * 2; // 2-4s
          const fallDistance = 600 + Math.random() * 400; // 600-1000px
          const rotation = 360 + Math.random() * 720; // 360-1080deg
          const swayX = (Math.random() - 0.5) * 200; // -100 to 100px
          
          confetti.style.setProperty('--duration', duration + 's');
          confetti.style.setProperty('--fall-distance', fallDistance + 'px');
          confetti.style.setProperty('--rotation', rotation + 'deg');
          confetti.style.setProperty('--sway', swayX + 'px');
          
          document.body.appendChild(confetti);
          
          // Remove ap√≥s anima√ß√£o
          setTimeout(() => confetti.remove(), duration * 1000 + 100);
        }, i * 25); // Delay entre cada confetti
      }
    }

    function finish(n, win, nb, backendData) {
      log('üèÅ FINISH:', n, 'Win:', win, 'Bet:', currentBetAmount);
      if((!n && n !== 0) || !backendData) return;
      
      spinning = false;
      
      // Atualiza balance do backend
      if(backendData.newBalance !== undefined && backendData.newBalance !== null) {
        bal = Number(backendData.newBalance);
      }
      
      // Mostra WIN ou LOSE no centro da roleta
      showResultOverlay(win);
      
      updateUI();
      
      // Envia atualiza√ß√£o de saldo
      if(ws && ws.readyState === 1) {
        ws.send(JSON.stringify({eventType:'BALANCE_UPDATED',userId:pid,balance:bal,timestamp:new Date().toISOString()}));
      }
      
      // Destaca n√∫mero vencedor na mesa
      const el = document.querySelector(`.cell[data-k="number"][data-v="${n}"]`);
      if(el) setTimeout(() => el.classList.add('win-anim'), 100);
      
      // Adiciona ao hist√≥rico (Recent Numbers)
      addToRecentNumbers(n);
      
      const betResultData = {
        eventType: 'BET_RESULT',
        userId: pid,
        number: n,
        betAmount: currentBetAmount,
        win: win,
        winAmount: backendData.winAmount || 0,    // Total payout do backend
        netWin: backendData.netWin || 0,           // Lucro l√≠quido do backend
        timestamp: new Date().toISOString()
      };
      
      addBetToLog(betResultData);
      if(ws && ws.readyState === 1) ws.send(JSON.stringify(betResultData));
      
      // AUTO MODE: Mant√©m apostas e agenda pr√≥ximo spin
      if(autoMode) {
        let total = 0; bets.forEach(v => total += v);
        if(total === 0 || total > bal) {
          autoMode = false;
          $('btnManual').classList.add('active');
          $('btnAuto').classList.remove('active');
          alert(total === 0 ? 'Auto stopped: No bets' : 'Auto stopped: Insufficient balance');
        } else {
          if(autoSpinTimeout) clearTimeout(autoSpinTimeout);
          autoSpinTimeout = setTimeout(spin, autoSpinDelay);
        }
      } else {
        bets.clear();
        currentBetAmount = 0;
      }
      updateUI();
      log('‚úÖ Round:', n, 'Bal:', bal);
    }

    function connect() {
      if(ws)ws.close(); $('connText').textContent='Connecting...';
      ws=new WebSocket(`${WS_URL}?token=${pid}`);
      
      ws.onopen=()=>{ 
        $('dot').style.background='#22c55e'; 
        $('connText').textContent='Online';
        log('‚úÖ Connected:', pid);
        if(selectedAvatar) ws.send(JSON.stringify({eventType:'SET_AVATAR',userId:pid,avatar:selectedAvatar}));
      };
      
      ws.onclose=()=>{ $('dot').style.background='#ef4444'; $('connText').textContent='Offline'; };
      ws.onerror=()=>{ $('dot').style.background='#ef4444'; $('connText').textContent='Error'; };
      
      ws.onmessage=e=>{ 
        try {
          const msg = JSON.parse(e.data);
          log('üì® WS:', msg.eventType || msg.status);
          
          if(msg.status === 'RECEIVED') { if(msg.newBalance !== undefined) { bal = msg.newBalance; updateUI(); } return; }
          if(msg.status === 'ERROR' && msg.error === 'INSUFFICIENT_BALANCE') { alert(`Insufficient balance!\n\nCurrent balance: ${fmt(msg.currentBalance)}\nRequired amount: ${fmt(msg.requiredAmount)}`); spinning = false; updateUI(); return; }
          if(msg.eventType === 'BALANCE_UPDATE') { bal = msg.balance; updateUI(); return; }
          if(msg.eventType === 'BALANCE_UPDATED') return;
          if(msg.eventType === 'ACTIVE_PLAYERS_UPDATE') { handleActivePlayersUpdate(msg); return; }
          if(msg.eventType === 'CHAT_MESSAGE') { handleChatMessage(msg); return; }
          if(msg.eventType === 'BET_RESULT') { if(msg.userId !== pid) addBetToLog(msg); return; }
          
          const isResult = msg.eventType === 'ROUND_RESULT' || msg.type === 'GAME_RESULT' || msg.number !== undefined || msg.resultNumber !== undefined || msg.winningNumber !== undefined;
          if(isResult) result(msg);
        } catch(x) { logError('‚ùå Parse error:', x); }
      };
    }

    /* BETS LOG */
    function addBetToLog(betData) {
      if(!betData.userId || betData.number === undefined) return;
      betsLog.unshift(betData);
      if(betsLog.length > 100) betsLog.pop();
      renderBetsLog();
      const liveDot = $('liveDot');
      if(liveDot) { liveDot.style.display = 'inline'; setTimeout(() => liveDot.style.display = 'none', 3000); }
    }
    
    let currentFilter = 'all';
    
    function renderBetsLog(filter) {
      if(filter !== undefined) currentFilter = filter; else filter = currentFilter;
      const container = $('betsLog');
      if(!container) return;
      
      let filtered = filter === 'wins' ? betsLog.filter(b => b.win) : filter === 'my' ? betsLog.filter(b => b.userId === pid) : betsLog;
      $('totalBets').textContent = `${betsLog.length} bet${betsLog.length !== 1 ? 's' : ''}`;
      
      // Renderiza
      container.innerHTML = '';
      
      if(filtered.length === 0) {
        container.innerHTML = '<div style="padding:20px;text-align:center;color:#555;font-size:12px;">No bets yet. Start playing!</div>';
        return;
      }
      
      filtered.forEach((bet, idx) => {
        const row = document.createElement('div');
        row.className = 'leaderboard-row';
        
        // Formata hor√°rio
        const time = formatChatTime(bet.timestamp);
        
        // Usa netWin do backend (se dispon√≠vel) ou calcula
        const profitLoss = bet.netWin !== undefined ? bet.netWin : 
                          (bet.win ? bet.winAmount - bet.betAmount : -bet.betAmount);
        const profitColor = profitLoss > 0 ? '#22c55e' : '#ef4444';
        const profitSign = profitLoss >= 0 ? '+' : '';
        
        // Destaque para vit√≥rias grandes (acima de $500)
        if(bet.win && profitLoss > 500) {
          row.classList.add('big-win-row');
        }
        // Destaque para apostas recentes (primeiras 3)
        else if(idx < 3) {
          row.style.background = 'rgba(245,158,11,0.05)';
        }
        
        // Cor do n√∫mero
        let numColor = '#15803d'; // green
        if(bet.number !== 0) {
          numColor = REDS.has(bet.number) ? '#dc2626' : '#e5e7eb';
        }
        
        // Extrai username para display (remove sessionId)
        const displayName = extractUsername(bet.userId);
        
        // Badge "YOU" para suas apostas
        const youBadge = bet.userId === pid ? '<span style="background:var(--accent);color:#000;font-size:8px;padding:2px 6px;border-radius:4px;margin-left:6px;font-weight:800;">YOU</span>' : '';
        
        row.innerHTML = `
          <div class="lb-user" style="color:${bet.userId === pid ? 'var(--accent)' : '#e5e7eb'}">${displayName}${youBadge}</div>
          <div style="color:#9ca3af;font-size:10px;">${time}</div>
          <div style="color:${numColor};font-weight:700;font-size:14px;">${bet.number}</div>
          <div style="color:#9ca3af;font-family:monospace;font-size:11px;">${fmt(bet.betAmount)}</div>
          <div style="color:${bet.win ? '#22c55e' : '#ef4444'};font-weight:700;font-size:11px;text-transform:uppercase;">${bet.win ? '‚úì WIN' : '‚úó LOSS'}</div>
          <div style="color:${profitColor};font-weight:700;font-family:monospace;font-size:12px;">${profitSign}${fmt(Math.abs(profitLoss))}</div>
        `;
        
        container.appendChild(row);
      });
    }
    
    /* INIT */
    $('btnAction').onclick=spin;
    
    const btnAddFunds = $('btnAddFunds');
    if(btnAddFunds) btnAddFunds.onclick = () => { window.openModal('depositModal'); initDepositModal(); };
    $('btnClear').onclick=()=>{
      bets.clear(); updateUI();
      if(autoMode) { autoMode = false; $('btnManual').classList.add('active'); $('btnAuto').classList.remove('active'); if(autoSpinTimeout) { clearTimeout(autoSpinTimeout); autoSpinTimeout = null; } }
    };
    $('btnConnect').onclick=connect;
    $('betInput').oninput=e=>chip=Number(e.target.value);
    
    // Settings button
    $('settingsBtn').onclick=()=>window.openModal('settingsModal');
    
    // Toggle Manual/Auto
    $('btnManual').onclick=()=>{ autoMode=false; $('btnManual').classList.add('active'); $('btnAuto').classList.remove('active'); if(autoSpinTimeout) { clearTimeout(autoSpinTimeout); autoSpinTimeout = null; } };
    
    $('btnAuto').onclick=()=>{ 
      let total = 0; bets.forEach(v => total += v);
      if(total === 0) { alert('Place bets first'); return; }
      if(total > bal) { alert('Insufficient balance'); return; }
      autoMode=true; $('btnAuto').classList.add('active'); $('btnManual').classList.remove('active');
      if(!spinning) spin();
    };
    
    // Chip selection
    document.querySelectorAll('.chip-select').forEach(c=>{
      c.onclick=()=>{
        if(c.id==='btnClear')return;
        document.querySelectorAll('.chip-select').forEach(x=>x.classList.remove('active'));
        c.classList.add('active'); 
        chip=Number(c.dataset.val); 
        $('betInput').value=chip;
      };
    });

    /* ACTIVE PLAYERS */
    function handleActivePlayersUpdate(msg) {
      const activeCount = msg.activeCount || msg.count || 0;
      const players = msg.players || msg.activePlayers || [];
      $('chatViewers').textContent = `${activeCount} üëÅ`;
      if(players.length > 0) { updatePlayersList(players); $('playerCount').textContent = activeCount; }
      else { $('playerList').innerHTML = '<div style="padding:20px;text-align:center;color:#555;font-size:12px;">No players online</div>'; $('playerCount').textContent = '0'; }
    }
    
    function updatePlayersList(players) {
      const pl = $('playerList');
      pl.innerHTML = '';
      players.forEach(p => {
        const d = document.createElement('div');
        d.className = 'player-item';
        const displayName = extractUsername(p.userId);
        const userColor = getUserColor(p.userId);
        let avatarContent = p.avatar && p.avatar.startsWith('http') ? `<img src="${p.avatar}" alt="Avatar" style="width:100%;height:100%;object-fit:cover;border-radius:12px;">` : p.avatar || (displayName || 'U')[0].toUpperCase();
        let playerBalance = '‚Äî', balanceColor = '#666';
        if(p.balance !== undefined && p.balance !== null) { playerBalance = fmt(p.balance); balanceColor = p.balance > 0 ? '#cfb53b' : '#ef4444'; }
        else if(p.userId === pid && bal > 0) { playerBalance = fmt(bal); balanceColor = '#cfb53b'; }
        d.innerHTML = `<div class="avatar" style="background:${userColor};color:#fff;${!p.avatar || !p.avatar.startsWith('http') ? 'font-size:14px;' : 'padding:2px;'}">${avatarContent}</div><div style="flex:1"><div class="p-name">${displayName}</div><div style="color:#555;font-size:10px;"><span style="color:#22c55e;">‚óè </span>Online</div></div><div class="p-win" style="font-size:11px;color:${balanceColor};">${playerBalance}</div>`;
        pl.appendChild(d);
      });
    }

    /* CHAT */
    function handleChatMessage(msg) {
      const userId = msg.userId || 'Anonymous';
      const message = msg.message || '';
      const timestamp = msg.timestamp || new Date().toISOString();
      if(!message.trim()) return;
      addMessageToChat(userId, message, timestamp);
    }
    
    function addMessageToChat(userId, message, timestamp) {
      const chatBox = $('chatBox');
      
      // Cria elemento de mensagem
      const msgDiv = document.createElement('div');
      msgDiv.className = 'chat-row';
      
      // Formata hor√°rio (HH:MM am/pm)
      const time = formatChatTime(timestamp);
      
      // Extrai username para display (remove sessionId)
      const displayName = extractUsername(userId);
      
      // Cor consistente para cada usu√°rio
      const userColor = getUserColor(userId);
      
      msgDiv.innerHTML = `
        <div style="margin-bottom:4px">
          <span style="color:${userColor};font-weight:600">${escapeHtml(displayName)}</span>
          <span style="color:#555;font-size:9px;margin-left:6px">${time}</span>
        </div>
        <span style="color:#d1d5db">${escapeHtml(message)}</span>
      `;
      
      chatBox.appendChild(msgDiv);
      chatBox.scrollTop = chatBox.scrollHeight;
      if(userId !== pid) { const chatLiveDot = $('chatLiveDot'); if(chatLiveDot) { chatLiveDot.style.display = 'inline'; setTimeout(() => chatLiveDot.style.display = 'none', 3000); } }
    }
    
    function sendChatMessage(message) {
      if(!ws || ws.readyState !== 1) { alert('Not connected'); return; }
      if(!message || !message.trim()) return;
      ws.send(JSON.stringify({eventType:'CHAT_MESSAGE',userId:pid,message:message.trim(),timestamp:new Date().toISOString()}));
    }
    
    function formatChatTime(timestamp) {
      try {
        const date = new Date(timestamp);
        let hours = date.getHours();
        const minutes = date.getMinutes();
        const ampm = hours >= 12 ? 'pm' : 'am';
        hours = hours % 12 || 12;
        const minutesStr = minutes.toString().padStart(2, '0');
        return `${hours}:${minutesStr} ${ampm}`;
      } catch(e) {
        return 'now';
      }
    }
    
    function getUserColor(userId) {
      // Gera cor consistente baseada no userId
      const hash = userId.split('').reduce((acc, char) => acc + char.charCodeAt(0), 0);
      const colors = [
        '#60a5fa', // blue
        '#a78bfa', // purple
        '#34d399', // green
        '#fb923c', // orange
        '#f87171', // red
        '#fbbf24', // yellow
        '#4ade80', // light green
        '#c084fc', // light purple
      ];
      return colors[hash % colors.length];
    }
    
    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }
    
    function clearChatMessages() { $('chatBox').innerHTML = ''; }

    // Hist√≥rico de n√∫meros recentes
    let recentNumbers = [];
    
    function initCoinSlots() { 
      renderRecentNumbers();
    }
    
    function addToRecentNumbers(n) {
      // Adiciona no in√≠cio do array
      recentNumbers.unshift(n);
      // Mant√©m apenas os √∫ltimos 10
      if(recentNumbers.length > 10) recentNumbers.pop();
      renderRecentNumbers();
    }
    
    function renderRecentNumbers() {
      const container = $('historyCoins');
      container.innerHTML = '';
      
      for(let i = 0; i < 10; i++) {
        const slot = document.createElement('div');
        slot.className = 'coin-slot';
        
        if(i < recentNumbers.length) {
          const n = recentNumbers[i];
          slot.textContent = n;
          
          // Cor baseada no n√∫mero
          if(n === 0) {
            slot.classList.add('coin-green');
          } else if(REDS.has(n)) {
            slot.classList.add('coin-red');
          } else {
            slot.classList.add('coin-black');
          }
          
          // Destaque no mais recente
          if(i === 0) {
            slot.classList.add('latest');
          }
        } else {
          slot.textContent = '‚Äî';
          slot.style.color = 'rgba(255,255,255,0.1)';
        }
        
        container.appendChild(slot);
      }
    }
    
    /* MODALS */
    window.openModal = function(modalId) {
      const modal = $(modalId);
      if(!modal) return;
      modal.classList.add('show');
      if(modalId === 'avatarModal') { renderAvatars(); const u = $('usernameInput'); if(u) { u.value = username; u.focus(); u.select(); } }
      if(modalId === 'settingsModal') { $('wsUrlInput').value = WS_URL; $('apiUrlInput').value = API_URL; $('soundEnabledCheckbox').checked = soundEnabled; }
    }
    window.closeModal = function(modalId) { const m = $(modalId); if(m) m.classList.remove('show'); }
    document.addEventListener('click', e => { if(e.target.classList.contains('modal-overlay')) e.target.classList.remove('show'); });
    
    function renderAvatars() {
      const grid = $('avatarGrid');
      grid.innerHTML = '';
      AVATARS.forEach(url => {
        const div = document.createElement('div');
        div.className = 'avatar-option' + (url === selectedAvatar ? ' selected' : '');
        const img = document.createElement('img');
        img.src = url; img.alt = 'Avatar'; img.loading = 'lazy';
        div.appendChild(img);
        div.onclick = () => selectAvatar(url);
        grid.appendChild(div);
      });
    }
    
    function selectAvatar(avatar) {
      selectedAvatar = avatar;
      document.querySelectorAll('.avatar-option').forEach(el => {
        const img = el.querySelector('img');
        el.classList.toggle('selected', img && img.src === avatar);
      });
    }
    
    window.saveSettings = function(event) {
      event.preventDefault();
      const newWsUrl = $('wsUrlInput').value.trim();
      const newApiUrl = $('apiUrlInput').value.trim();
      const newSoundEnabled = $('soundEnabledCheckbox').checked;
      if(!newWsUrl || (!newWsUrl.startsWith('ws://') && !newWsUrl.startsWith('wss://'))) { alert('Invalid WS URL'); return; }
      localStorage.setItem('wsUrl', newWsUrl);
      localStorage.setItem('apiUrl', newApiUrl);
      localStorage.setItem('soundEnabled', newSoundEnabled ? 'true' : 'false');
      WS_URL = newWsUrl; API_URL = newApiUrl; soundEnabled = newSoundEnabled;
      window.closeModal('settingsModal');
      if(ws) { alert('Settings saved! Reconnecting...'); ws.close(); setTimeout(connect, 500); }
      else alert('Settings saved!');
    }
    
    buildTable(); initWheel(); initCoinSlots(); updateUI();
    
    /* SAVE AVATAR AND USERNAME */
    window.saveAvatarAndUsername = function() {
      const usernameInput = $('usernameInput');
      const newName = usernameInput ? usernameInput.value.trim() : username;
      if(!newName) { alert('Username cannot be empty'); return; }
      const sanitized = newName.replace(/[^a-zA-Z0-9_-]/g, '');
      if(sanitized.length < 3) { alert('Username must be at least 3 characters'); return; }
      if(sanitized.length > 20) { alert('Username must be less than 20 characters'); return; }
      const usernameChanged = sanitized !== username;
      username = sanitized;
      pid = username + '_' + sessionId;
      updateUI();
      window.closeModal('avatarModal');
      if(usernameChanged) { setTimeout(() => { alert(`Profile updated!\n\nUsername: ${username}\n\nReconnecting...`); if(ws) { ws.close(); setTimeout(connect, 500); } }, 300); }
      else if(ws && ws.readyState === 1) ws.send(JSON.stringify({eventType:'SET_AVATAR',userId:pid,avatar:selectedAvatar}));
    }
    
    /* CHAT LISTENERS */
    const chatInput = document.querySelector('.chat-input');
    const chatSendBtn = document.querySelector('.chat-extended button');
    if(chatSendBtn) chatSendBtn.onclick = () => { if(chatInput.value.trim()) { sendChatMessage(chatInput.value); chatInput.value = ''; } };
    if(chatInput) chatInput.onkeypress = e => { if(e.key === 'Enter' && chatInput.value.trim()) { sendChatMessage(chatInput.value); chatInput.value = ''; } };
    clearChatMessages();
    
    /* TABS */
    const tabs = document.querySelectorAll('.top-players-full .tab');
    tabs.forEach((tab, idx) => { tab.onclick = () => { tabs.forEach(t => t.classList.remove('active')); tab.classList.add('active'); renderBetsLog(['all','wins','my'][idx]); }; });
    renderBetsLog();
    connect();
    
    /* DEPOSIT */
    let selectedDepositAmount = 0;
    let selectedPaymentMethod = null;
    let depositListenersSetup = false;
    
    function initDepositModal() {
      if(!depositListenersSetup) { setupDepositListeners(); depositListenersSetup = true; }
      selectedDepositAmount = 0; selectedPaymentMethod = null;
      const customInput = $('customDepositAmount'); if(customInput) customInput.value = '';
      const cardForm = $('cardForm'); const pixQR = $('pixQRCode'); const summary = $('depositSummary'); const confirmBtn = $('btnConfirmDeposit');
      if(cardForm) cardForm.classList.remove('active'); if(pixQR) pixQR.classList.remove('active'); if(summary) summary.style.display = 'none'; if(confirmBtn) confirmBtn.disabled = true;
      document.querySelectorAll('.deposit-amount-btn, .payment-method').forEach(btn => btn.classList.remove('selected'));
    }
    
    function setupDepositListeners() {
      document.querySelectorAll('.deposit-amount-btn').forEach(btn => {
        btn.onclick = () => {
          selectedDepositAmount = Number(btn.dataset.amount);
          document.querySelectorAll('.deposit-amount-btn').forEach(b => b.classList.remove('selected'));
          btn.classList.add('selected');
          const ci = $('customDepositAmount'); if(ci) ci.value = '';
          updateDepositSummary();
        };
      });
      const customInput = $('customDepositAmount');
      if(customInput) customInput.oninput = e => { const a = Number(e.target.value); selectedDepositAmount = a >= 10 ? a : 0; if(a >= 10) document.querySelectorAll('.deposit-amount-btn').forEach(b => b.classList.remove('selected')); updateDepositSummary(); };
      document.querySelectorAll('.payment-method').forEach(btn => {
        btn.onclick = () => {
          selectedPaymentMethod = btn.dataset.method;
          document.querySelectorAll('.payment-method').forEach(b => b.classList.remove('selected'));
          btn.classList.add('selected');
          const cf = $('cardForm'), pq = $('pixQRCode');
          if(cf) cf.classList.remove('active'); if(pq) pq.classList.remove('active');
          if(selectedPaymentMethod === 'credit' || selectedPaymentMethod === 'debit') { if(cf) cf.classList.add('active'); }
          else if(selectedPaymentMethod === 'pix' && pq) { pq.classList.add('active'); const pc = $('pixCode'); if(pc) pc.textContent = generatePixCode(); }
          updateDepositSummary();
        };
      });
      const confirmBtn = $('btnConfirmDeposit'); if(confirmBtn) confirmBtn.onclick = processDeposit;
      const cardNum = $('cardNumber'); if(cardNum) cardNum.oninput = e => { let v = e.target.value.replace(/\s/g, ''); e.target.value = v.match(/.{1,4}/g)?.join(' ') || v; };
      const cardExp = $('cardExpiry'); if(cardExp) cardExp.oninput = e => { let v = e.target.value.replace(/\D/g, ''); if(v.length >= 2) v = v.slice(0,2) + '/' + v.slice(2,4); e.target.value = v; };
    }
    
    function updateDepositSummary() {
      const summary = $('depositSummary'), confirmBtn = $('btnConfirmDeposit');
      if(selectedDepositAmount > 0 && selectedPaymentMethod) {
        const bp = calcBonus(selectedDepositAmount), ba = (selectedDepositAmount * bp) / 100, ta = selectedDepositAmount + ba;
        const sa = $('summaryAmount'), sb = $('summaryBonus'), st = $('summaryTotal');
        if(sa) sa.textContent = fmt(selectedDepositAmount);
        if(sb) sb.textContent = fmt(ba) + (bp > 0 ? ` (+${bp}%)` : '');
        if(st) st.textContent = fmt(ta);
        if(summary) summary.style.display = 'block';
        if(confirmBtn) confirmBtn.disabled = false;
      } else { if(summary) summary.style.display = 'none'; if(confirmBtn) confirmBtn.disabled = true; }
    }
    
    function generatePixCode() {
      const chars = '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ';
      let code = '00020126580014br.gov.bcb.pix0136';
      for(let i = 0; i < 36; i++) {
        code += chars[Math.floor(Math.random() * chars.length)];
      }
      code += '520400005303986540' + selectedDepositAmount.toFixed(2);
      code += '5802BR5913STRENGER CASINO6009SAO PAULO62070503***6304';
      for(let i = 0; i < 4; i++) {
        code += chars[Math.floor(Math.random() * chars.length)];
      }
      return code;
    }
    
    window.copyPixCode = function() {
      const pixCode = $('pixCode');
      if(!pixCode) return;
      
      const code = pixCode.textContent;
      navigator.clipboard.writeText(code).then(() => {
        alert('‚úÖ PIX code copied!\n\nPaste it in your bank app to complete the payment.');
      }).catch(() => {
        alert('‚ùå Error copying code. Please copy manually.');
      });
    }
    
    async function processDeposit() {
      if(!selectedDepositAmount || !selectedPaymentMethod) { alert('Please select amount and method'); return; }
      window.closeModal('depositModal');
      const overlay = $('processingOverlay'), content = $('processingContent');
      overlay.classList.add('active');
      await new Promise(r => setTimeout(r, 2500));
      const bp = calcBonus(selectedDepositAmount), ba = (selectedDepositAmount * bp) / 100, ta = selectedDepositAmount + ba;
      bal += ta;
      if(ws && ws.readyState === 1) ws.send(JSON.stringify({eventType:'BALANCE_UPDATED',userId:pid,balance:bal,timestamp:new Date().toISOString()}));
      updateUI();
      content.innerHTML = `<div class="success-checkmark">‚úì</div><div class="processing-text" style="color:#22c55e;">Deposit Approved!</div><div class="processing-subtext">Amount: ${fmt(selectedDepositAmount)}<br>Bonus: ${fmt(ba)}<br><strong style="color:#22c55e;font-size:16px;margin-top:8px;display:block;">Total: ${fmt(ta)}</strong></div>`;
      await new Promise(r => setTimeout(r, 3000));
      overlay.classList.remove('active');
      content.innerHTML = `<div class="processing-spinner"></div><div class="processing-text">Processing Payment...</div><div class="processing-subtext">Please wait a moment</div>`;
      initDepositModal();
    }
    
    window.addEventListener('beforeunload', () => {
      if(ws && ws.readyState === WebSocket.OPEN) {
        try { ws.send(JSON.stringify({eventType:'DISCONNECT',userId:pid,timestamp:new Date().toISOString()})); } catch(e) {}
        ws.close(1000, 'Tab closing');
      }
    });
  })();
  </script>

  <!-- MODAL: Avatar Selection -->
  <div class="modal-overlay" id="avatarModal">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-title">Choose Your Avatar</div>
        <button class="modal-close" onclick="closeModal('avatarModal')">√ó</button>
      </div>
      <div class="modal-body">
        <!-- Username Section -->
        <div class="settings-group" style="margin-bottom: 20px;">
          <label class="settings-label">Your Username</label>
          <input 
            type="text" 
            class="settings-input" 
            id="usernameInput" 
            placeholder="Enter your username"
            maxlength="20"
            style="text-align: center; font-size: 16px; font-weight: 600;"
          >
          <div class="settings-hint">3-20 characters, letters/numbers only</div>
        </div>
        
        <!-- Avatar Grid -->
        <label class="settings-label" style="margin-bottom: 12px; display: block;">Select Avatar</label>
        <div class="avatar-grid" id="avatarGrid">
          <!-- Avatares ser√£o adicionados via JS -->
        </div>
        
        <!-- Bot√µes de A√ß√£o -->
        <div class="settings-buttons" style="margin-top: 20px;">
          <button type="button" class="modal-btn modal-btn-secondary" onclick="closeModal('avatarModal')">Cancel</button>
          <button type="button" class="modal-btn modal-btn-primary" onclick="saveAvatarAndUsername()">Save Changes</button>
        </div>
      </div>
    </div>
  </div>

  <!-- MODAL: Settings -->
  <div class="modal-overlay" id="settingsModal">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-title">‚öôÔ∏è Settings</div>
        <button class="modal-close" onclick="closeModal('settingsModal')">√ó</button>
      </div>
      <div class="modal-body">
        <form id="settingsForm" onsubmit="saveSettings(event)">
          <div class="settings-group">
            <label class="settings-label">WebSocket URL</label>
            <input 
              type="text" 
              class="settings-input" 
              id="wsUrlInput" 
              placeholder="ws://localhost:8081/ws"
              required
            >
            <div class="settings-hint">WebSocket server URL (e.g., ws://your-app.cloudhub.io/ws)</div>
          </div>
          
          <div class="settings-group">
            <label class="settings-label">API URL (opcional)</label>
            <input 
              type="text" 
              class="settings-input" 
              id="apiUrlInput" 
              placeholder="http://localhost:8081/api"
            >
            <div class="settings-hint">REST API URL (if needed)</div>
          </div>
          
          <div class="settings-group">
            <label class="settings-label" style="display:flex;align-items:center;gap:10px;cursor:pointer;">
            <input 
              type="checkbox" 
              id="soundEnabledCheckbox" 
              style="width:20px;height:20px;cursor:pointer;"
            >
            <span>Enable Sounds</span>
          </label>
          <div class="settings-hint">Tick sounds during wheel rotation</div>
        </div>
        
        <div class="settings-buttons">
          <button type="button" class="modal-btn modal-btn-secondary" onclick="closeModal('settingsModal')">
            Cancel
          </button>
          <button type="submit" class="modal-btn modal-btn-primary">
            Save & Reconnect
          </button>
        </div>
      </form>
    </div>
  </div>
  </div>

  <!-- MODAL: Add Funds / Deposit -->
  <div class="modal-overlay" id="depositModal">
    <div class="modal-content" style="max-width: 500px;">
      <div class="modal-header">
        <div class="modal-title">üí∞ Add Funds</div>
        <button class="modal-close" onclick="closeModal('depositModal')">√ó</button>
      </div>
      <div class="modal-body">
        <!-- Amount Selection -->
        <div class="settings-group">
          <label class="settings-label">Select Amount</label>
          <div class="deposit-amounts">
            <div class="deposit-amount-btn" data-amount="100">
              <span class="amount">$100</span>
            </div>
            <div class="deposit-amount-btn" data-amount="500">
              <span class="amount">$500</span>
              <span class="bonus">+5% Bonus</span>
            </div>
            <div class="deposit-amount-btn" data-amount="1000">
              <span class="amount">$1,000</span>
              <span class="bonus">+10% Bonus</span>
            </div>
            <div class="deposit-amount-btn" data-amount="2500">
              <span class="amount">$2,500</span>
              <span class="bonus">+15% Bonus</span>
            </div>
            <div class="deposit-amount-btn" data-amount="5000">
              <span class="amount">$5,000</span>
              <span class="bonus">+20% Bonus</span>
            </div>
            <div class="deposit-amount-btn" data-amount="10000">
              <span class="amount">$10,000</span>
              <span class="bonus">+25% Bonus</span>
            </div>
          </div>
          
          <!-- Custom Amount -->
          <label class="settings-label" style="margin-top: 12px;">Or Enter Custom Amount</label>
          <input 
            type="number" 
            class="settings-input" 
            id="customDepositAmount" 
            placeholder="$0.00"
            min="10"
            step="10"
            style="text-align: center; font-size: 18px; font-weight: 700;"
          >
          <div class="settings-hint">Minimum deposit: $10.00</div>
        </div>
        
        <!-- Payment Method -->
        <div class="settings-group">
          <label class="settings-label">Payment Method</label>
          <div class="payment-methods">
            <div class="payment-method" data-method="pix">
              <div class="payment-method-icon">üî∑</div>
              <div class="payment-method-info">
                <div class="payment-method-name">PIX</div>
                <div class="payment-method-desc">Instant</div>
              </div>
            </div>
            <div class="payment-method" data-method="credit">
              <div class="payment-method-icon">üí≥</div>
              <div class="payment-method-info">
                <div class="payment-method-name">Credit Card</div>
                <div class="payment-method-desc">Quick approval</div>
              </div>
            </div>
            <div class="payment-method" data-method="debit">
              <div class="payment-method-icon">üí≥</div>
              <div class="payment-method-info">
                <div class="payment-method-name">Debit Card</div>
                <div class="payment-method-desc">Immediate debit</div>
              </div>
            </div>
            <div class="payment-method" data-method="boleto">
              <div class="payment-method-icon">üìÑ</div>
              <div class="payment-method-info">
                <div class="payment-method-name">Bank Transfer</div>
                <div class="payment-method-desc">1-3 business days</div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Card Form (hidden by default) -->
        <div class="card-form" id="cardForm">
          <div class="settings-group">
            <label class="settings-label">Card Details</label>
            <div class="card-input-group">
              <input 
                type="text" 
                class="settings-input" 
                id="cardNumber" 
                placeholder="Card Number"
                maxlength="19"
              >
            </div>
            <div class="card-input-group">
              <input 
                type="text" 
                class="settings-input" 
                id="cardName" 
                placeholder="Name on Card"
              >
            </div>
            <div class="card-input-row">
              <input 
                type="text" 
                class="settings-input" 
                id="cardExpiry" 
                placeholder="MM/YY"
                maxlength="5"
              >
              <input 
                type="text" 
                class="settings-input" 
                id="cardCVV" 
                placeholder="CVV"
                maxlength="3"
              >
            </div>
          </div>
        </div>
        
        <!-- QR Code PIX (hidden by default) -->
        <div class="pix-qrcode" id="pixQRCode">
          <div class="qr-placeholder">üì±</div>
          <div class="settings-label" style="margin-bottom: 8px;">Scan QR Code</div>
          <div class="pix-code" id="pixCode">
            00020126580014br.gov.bcb.pix0136a1b2c3d4-e5f6-7890-abcd-ef1234567890520400005303986540510.005802BR5913STRENGER CASINO6009SAO PAULO62070503***63041D3D
          </div>
          <button type="button" class="modal-btn modal-btn-secondary" onclick="copyPixCode()" style="width: 100%;">
            üìã Copy PIX Code
          </button>
        </div>
        
        <!-- Deposit Summary -->
        <div class="deposit-summary" id="depositSummary" style="display:none;">
          <div class="deposit-summary-row">
            <span class="deposit-summary-label">Deposit Amount:</span>
            <span class="deposit-summary-value" id="summaryAmount">$0.00</span>
          </div>
          <div class="deposit-summary-row">
            <span class="deposit-summary-label">Bonus:</span>
            <span class="deposit-summary-value" id="summaryBonus" style="color:#22c55e;">$0.00</span>
          </div>
          <div class="deposit-summary-row">
            <span class="deposit-summary-label">Total to Receive:</span>
            <span class="deposit-summary-value total" id="summaryTotal">$0.00</span>
          </div>
        </div>
        
        <!-- Action Buttons -->
        <div class="settings-buttons">
          <button type="button" class="modal-btn modal-btn-secondary" onclick="closeModal('depositModal')">
            Cancel
          </button>
          <button type="button" class="modal-btn modal-btn-primary" id="btnConfirmDeposit" disabled>
            Confirm Deposit
          </button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Processing Overlay -->
  <div class="processing-overlay" id="processingOverlay">
    <div class="processing-content" id="processingContent">
      <div class="processing-spinner"></div>
      <div class="processing-text">Processing Payment...</div>
      <div class="processing-subtext">Please wait a moment</div>
    </div>
  </div>

</body>
</html>
